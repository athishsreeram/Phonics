<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phonics Fun! ğŸ‰</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap');
:root {
  --pink:#FF6B9D;--yellow:#FFD93D;--blue:#4FC3F7;--green:#69E090;
  --purple:#B388FF;--orange:#FFA552;--red:#FF4757;--teal:#26de81;
  --bg:#FFF8F0;--text:#3D2C8D;--radius:22px;
}
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Nunito',sans-serif;background:var(--bg);min-height:100vh;overflow-x:hidden;}
.bubbles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden;}
.bubble{position:absolute;border-radius:50%;opacity:.15;animation:floatUp linear infinite;}
@keyframes floatUp{0%{transform:translateY(100vh) scale(.5);opacity:.1;}100%{transform:translateY(-100px) scale(1);opacity:0;}}
.page{position:relative;z-index:1;min-height:100vh;}

/* HOME */
#home{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px;text-align:center;}
.home-logo{font-family:'Fredoka One',cursive;font-size:clamp(2.8rem,9vw,4.5rem);background:linear-gradient(135deg,var(--pink),var(--purple),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:bounce 2s ease-in-out infinite;margin-bottom:8px;}
.home-subtitle{font-size:clamp(.95rem,2.5vw,1.2rem);color:var(--text);margin-bottom:32px;font-weight:700;}
@keyframes bounce{0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);}}
.input-card{background:#fff;border-radius:var(--radius);padding:32px 28px;max-width:400px;width:100%;box-shadow:0 12px 40px rgba(61,44,141,.12);border:3px solid var(--yellow);}
.input-card label{display:block;font-size:1.1rem;font-weight:800;color:var(--text);margin-bottom:12px;}
.letter-input{width:100%;padding:16px;font-size:2rem;font-family:'Fredoka One',cursive;text-align:center;border:3px solid var(--purple);border-radius:14px;color:var(--text);outline:none;text-transform:uppercase;transition:border-color .2s,box-shadow .2s;}
.letter-input:focus{border-color:var(--pink);box-shadow:0 0 0 4px rgba(255,107,157,.2);}
.start-btn{margin-top:18px;width:100%;padding:16px;font-family:'Fredoka One',cursive;font-size:1.4rem;background:linear-gradient(135deg,var(--pink),var(--orange));color:#fff;border:none;border-radius:14px;cursor:pointer;box-shadow:0 6px 20px rgba(255,107,157,.4);transition:transform .15s,box-shadow .15s;}
.start-btn:hover{transform:translateY(-3px);}
.emoji-row{font-size:2.2rem;margin-top:28px;animation:wobble 3s ease-in-out infinite;}
@keyframes wobble{0%,100%{transform:rotate(-5deg);}50%{transform:rotate(5deg);}}

/* ACTIVITY PAGE */
#activities{display:none;}
.act-header{background:linear-gradient(135deg,var(--purple),var(--blue));padding:16px 18px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:100;box-shadow:0 4px 20px rgba(0,0,0,.1);}
.back-btn{background:rgba(255,255,255,.25);border:none;border-radius:10px;color:#fff;font-size:1.4rem;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;flex-shrink:0;}
.back-btn:hover{background:rgba(255,255,255,.4);}
.act-header h1{font-family:'Fredoka One',cursive;color:#fff;font-size:clamp(1.1rem,3.5vw,1.6rem);}
.letter-badge{margin-left:auto;background:var(--yellow);border-radius:50%;width:46px;height:46px;font-family:'Fredoka One',cursive;font-size:1.6rem;color:var(--text);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(0,0,0,.15);flex-shrink:0;}

/* TABS */
.tabs-wrapper{background:#fff;border-bottom:3px solid #f0e8ff;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none;}
.tabs-wrapper::-webkit-scrollbar{display:none;}
.tabs{display:flex;min-width:max-content;padding:0 4px;}
.tab{padding:10px 12px;border:none;background:none;font-family:'Nunito',sans-serif;font-size:.72rem;font-weight:800;color:#aaa;cursor:pointer;transition:color .2s;display:flex;flex-direction:column;align-items:center;gap:3px;border-bottom:3px solid transparent;white-space:nowrap;margin-bottom:-3px;}
.tab .ti{font-size:1.3rem;}
.tab.active{color:var(--purple);border-bottom-color:var(--purple);}
.tab:hover{color:var(--pink);}

/* PANELS */
.activity-panel{display:none;padding:16px;max-width:680px;margin:0 auto;animation:fadeIn .3s ease;}
.activity-panel.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:none;}}
.act-card{background:#fff;border-radius:var(--radius);padding:20px;margin-bottom:16px;box-shadow:0 6px 24px rgba(61,44,141,.08);}
.act-title{font-family:'Fredoka One',cursive;font-size:1.4rem;color:var(--text);margin-bottom:4px;}
.act-desc{color:#888;font-size:.9rem;margin-bottom:16px;font-weight:700;}

/* BUTTONS */
.btn{padding:12px 20px;border:none;border-radius:12px;font-family:'Nunito',sans-serif;font-weight:800;font-size:.95rem;cursor:pointer;transition:transform .15s,box-shadow .15s;display:inline-flex;align-items:center;gap:7px;}
.btn:hover{transform:translateY(-2px);}
.btn:active{transform:translateY(0);}
.btn-pink{background:var(--pink);color:#fff;box-shadow:0 4px 14px rgba(255,107,157,.35);}
.btn-green{background:var(--green);color:#1a5c35;box-shadow:0 4px 14px rgba(105,224,144,.35);}
.btn-blue{background:var(--blue);color:#0d3d57;box-shadow:0 4px 14px rgba(79,195,247,.35);}
.btn-purple{background:var(--purple);color:#fff;box-shadow:0 4px 14px rgba(179,136,255,.35);}
.btn-orange{background:var(--orange);color:#fff;box-shadow:0 4px 14px rgba(255,165,82,.35);}
.btn-yellow{background:var(--yellow);color:var(--text);box-shadow:0 4px 14px rgba(255,217,61,.35);}
.btn-red{background:var(--red);color:#fff;box-shadow:0 4px 14px rgba(255,71,87,.35);}
.btn-teal{background:var(--teal);color:#0d3d2a;box-shadow:0 4px 14px rgba(38,222,129,.35);}
.btn-sm{padding:9px 16px;font-size:.85rem;}
.btn-full{width:100%;justify-content:center;margin-top:12px;}

/* STATUS */
.sound-status{text-align:center;font-size:1rem;font-weight:700;padding:12px;border-radius:12px;margin:12px 0;}
.status-neutral{background:#f5f0ff;color:var(--purple);}
.status-success{background:#d4f8e5;color:#1a7a45;}
.status-error{background:#ffe0e8;color:#c0284a;}
.status-recording{background:#fff0d4;color:#a0520d;animation:blink 1s step-end infinite;}
@keyframes blink{50%{opacity:.5;}}
.stars{font-size:1.8rem;text-align:center;letter-spacing:4px;}

/* ACT 1: SOUND */
.big-letter{font-family:'Fredoka One',cursive;font-size:clamp(5rem,18vw,9rem);text-align:center;line-height:1;background:linear-gradient(135deg,var(--purple),var(--pink));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:pulse 2s ease-in-out infinite;}
@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.05);}}

/* ACT 2: TRACE */
#traceCanvas{border:3px dashed var(--purple);border-radius:14px;touch-action:none;cursor:crosshair;display:block;margin:0 auto;max-width:100%;}
.trace-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px;justify-content:center;}

/* ACT 3: CIRCLE */
.word-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:10px;}
.word-item{border:3px solid #e8e0ff;border-radius:14px;padding:12px 8px;text-align:center;cursor:pointer;transition:all .2s;font-size:1rem;font-weight:800;color:var(--text);user-select:none;background:#fff;}
.word-item:hover{border-color:var(--purple);background:#f5f0ff;}
.word-item.selected{background:var(--green);border-color:#2ecc71;color:#155724;transform:scale(1.05);}
.word-item.wrong{background:#ffe0e8;border-color:var(--pink);animation:shake .4s;}
.word-item .we{font-size:1.6rem;display:block;margin-bottom:4px;}
@keyframes shake{0%,100%{transform:translateX(0);}25%{transform:translateX(-6px);}75%{transform:translateX(6px);}}

/* ACT 4: FILL */
.fill-word{font-family:'Fredoka One',cursive;font-size:clamp(2rem,7vw,3rem);text-align:center;color:var(--text);margin:16px 0;letter-spacing:6px;}
.fill-blank{display:inline-block;border-bottom:5px solid var(--purple);min-width:48px;color:var(--purple);padding:0 4px;}
.options-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;margin-top:14px;}
.option-btn{padding:16px 8px;border:3px solid #e8e0ff;border-radius:14px;background:#fff;font-family:'Fredoka One',cursive;font-size:1.4rem;color:var(--text);cursor:pointer;transition:all .2s;text-align:center;}
.option-btn:hover{border-color:var(--purple);background:#f5f0ff;}
.option-btn.correct{background:var(--green);border-color:#2ecc71;color:#155724;}
.option-btn.incorrect{background:#ffe0e8;border-color:var(--pink);animation:shake .4s;}

/* ACT 5: DRAW */
#drawCanvas{border:3px solid var(--orange);border-radius:14px;touch-action:none;cursor:crosshair;display:block;margin:0 auto;max-width:100%;background:#fff;}
.draw-toolbar{display:flex;gap:7px;align-items:center;flex-wrap:wrap;margin-bottom:12px;justify-content:center;}
.color-dot{width:32px;height:32px;border-radius:50%;border:3px solid transparent;cursor:pointer;transition:transform .15s,border-color .15s;}
.color-dot.active{border-color:var(--text);transform:scale(1.2);}
.size-slider{width:90px;accent-color:var(--orange);}
.draw-prompt{background:linear-gradient(135deg,var(--orange),var(--yellow));border-radius:14px;padding:14px 18px;margin-bottom:14px;font-weight:800;font-size:1rem;color:#fff;text-align:center;}

/* ACT 6: LISTEN */
.listen-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:12px;margin-top:10px;}
.listen-card{border:3px solid #e8e0ff;border-radius:18px;padding:18px 10px;text-align:center;cursor:pointer;transition:all .2s;background:#fff;position:relative;overflow:hidden;}
.listen-card:hover{border-color:var(--blue);transform:translateY(-4px);box-shadow:0 8px 24px rgba(79,195,247,.25);}
.listen-card.playing{border-color:var(--blue);background:#e0f7fe;}
.listen-emoji{font-size:2.2rem;display:block;margin-bottom:6px;}
.listen-word{font-family:'Fredoka One',cursive;font-size:1.3rem;color:var(--text);}
.listen-hint{font-size:.75rem;color:#aaa;font-weight:700;margin-top:4px;}
.spk{position:absolute;top:7px;right:9px;font-size:1rem;opacity:.4;}
.listen-card.playing .spk{opacity:1;animation:blink .5s step-end infinite;}

/* ============================================================
   GAME 7: WORD BUILDER (drag tiles)
============================================================ */
.tile-bank{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;min-height:60px;border:2px dashed #ddd;border-radius:14px;padding:10px;margin-bottom:14px;}
.letter-tile{width:50px;height:56px;border-radius:12px;border:3px solid var(--purple);background:linear-gradient(135deg,#f5f0ff,#ede0ff);font-family:'Fredoka One',cursive;font-size:1.6rem;color:var(--text);display:flex;align-items:center;justify-content:center;cursor:grab;user-select:none;transition:transform .15s,box-shadow .15s;}
.letter-tile:hover{transform:scale(1.1);box-shadow:0 4px 14px rgba(179,136,255,.4);}
.letter-tile.dragging{opacity:.4;}
.drop-zone{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;min-height:70px;border:3px dashed var(--green);border-radius:14px;padding:10px;background:#f0fff6;margin-bottom:14px;}
.drop-zone.drag-over{background:#d4f8e5;border-color:#2ecc71;}
.word-hint-img{font-size:4rem;text-align:center;margin:10px 0;}
.builder-result{text-align:center;font-weight:800;font-size:1.1rem;padding:12px;border-radius:12px;margin-top:10px;}

/* GAME 8: ANAGRAM */
.anagram-display{font-family:'Fredoka One',cursive;font-size:clamp(1.4rem,5vw,2.2rem);text-align:center;color:var(--pink);letter-spacing:8px;margin:12px 0;background:#fff0f5;border-radius:12px;padding:14px;}
.anagram-input{width:100%;padding:14px;font-size:1.5rem;font-family:'Fredoka One',cursive;text-align:center;border:3px solid var(--orange);border-radius:12px;color:var(--text);outline:none;text-transform:uppercase;letter-spacing:6px;}

/* GAME 9: MEMORY MATCH */
.memory-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
@media(max-width:400px){.memory-grid{grid-template-columns:repeat(3,1fr);}}
.mem-card{aspect-ratio:1;border-radius:14px;border:3px solid #e8e0ff;cursor:pointer;position:relative;transform-style:preserve-3d;transition:transform .4s;perspective:600px;}
.mem-card .mem-front,.mem-card .mem-back{position:absolute;width:100%;height:100%;display:flex;align-items:center;justify-content:center;border-radius:11px;backface-visibility:hidden;-webkit-backface-visibility:hidden;}
.mem-card .mem-front{background:linear-gradient(135deg,var(--purple),var(--blue));font-size:1.6rem;color:#fff;}
.mem-card .mem-back{background:#fff;transform:rotateY(180deg);}
.mem-card.flipped{transform:rotateY(180deg);}
.mem-card.matched{border-color:var(--green);box-shadow:0 0 0 3px rgba(105,224,144,.5);}
.mem-score{font-family:'Fredoka One',cursive;font-size:1.2rem;color:var(--text);text-align:center;margin-bottom:12px;}

/* GAME 10: SOUND MATCH */
.sound-choices{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-top:14px;}
.sound-choice{border:3px solid #e8e0ff;border-radius:18px;padding:20px;text-align:center;cursor:pointer;transition:all .2s;background:#fff;font-size:2.5rem;}
.sound-choice:hover{border-color:var(--blue);transform:scale(1.04);}
.sound-choice.correct{background:#d4f8e5;border-color:var(--green);}
.sound-choice.wrong{background:#ffe0e8;border-color:var(--red);animation:shake .4s;}
.sound-question{background:linear-gradient(135deg,var(--blue),var(--purple));border-radius:16px;padding:20px;text-align:center;cursor:pointer;margin-bottom:16px;}
.sound-question h3{font-family:'Fredoka One',cursive;font-size:1.3rem;color:#fff;margin-bottom:6px;}
.sound-question p{color:rgba(255,255,255,.85);font-size:.9rem;font-weight:700;}

/* GAME 11: SORTING BIN */
.sort-arena{min-height:120px;display:flex;align-items:center;justify-content:center;margin:12px 0;}
.sort-word-card{background:linear-gradient(135deg,var(--yellow),var(--orange));border-radius:18px;padding:18px 30px;font-family:'Fredoka One',cursive;font-size:clamp(1.4rem,5vw,2rem);color:#fff;cursor:grab;user-select:none;box-shadow:0 6px 20px rgba(255,165,82,.4);transition:transform .2s;text-align:center;}
.sort-word-card:hover{transform:scale(1.05);}
.sort-bins{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:14px;}
.sort-bin{border:3px dashed #e8e0ff;border-radius:18px;padding:16px;text-align:center;min-height:120px;transition:all .2s;}
.sort-bin.has-letter{border-color:var(--green);background:#f0fff6;}
.sort-bin.no-letter{border-color:var(--pink);background:#fff5f8;}
.sort-bin.drag-over{transform:scale(1.03);box-shadow:0 8px 24px rgba(0,0,0,.1);}
.sort-bin h3{font-family:'Fredoka One',cursive;font-size:1.1rem;margin-bottom:8px;}
.sort-bin-items{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;min-height:50px;}
.sort-chip{background:#fff;border:2px solid #ddd;border-radius:20px;padding:5px 12px;font-weight:800;font-size:.85rem;color:var(--text);}
.sort-chip.correct-place{background:var(--green);border-color:#2ecc71;color:#155724;}
.sort-chip.wrong-place{background:#ffe0e8;border-color:var(--pink);}

/* GAME 12: POSITION SORT */
.pos-word-display{font-family:'Fredoka One',cursive;font-size:clamp(1.8rem,6vw,2.8rem);text-align:center;margin:12px 0;color:var(--text);}
.pos-word-display .hl{color:var(--pink);text-decoration:underline wavy var(--pink);}
.pos-choices{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:14px;}
.pos-btn{padding:16px 24px;border:3px solid #e8e0ff;border-radius:14px;background:#fff;font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--text);cursor:pointer;transition:all .2s;}
.pos-btn:hover{border-color:var(--purple);}
.pos-btn.correct{background:var(--green);border-color:#2ecc71;color:#155724;}
.pos-btn.incorrect{background:#ffe0e8;border-color:var(--red);animation:shake .4s;}

/* GAME 13: SILLY SENTENCE */
.sentence-display{background:linear-gradient(135deg,#fff0f5,#f0e8ff);border-radius:18px;padding:20px;font-family:'Fredoka One',cursive;font-size:clamp(1.1rem,3.5vw,1.6rem);color:var(--text);text-align:center;min-height:80px;display:flex;align-items:center;justify-content:center;margin:14px 0;line-height:1.4;}
.word-select-row{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:8px 0;}
.word-pill{padding:10px 18px;border:3px solid #e8e0ff;border-radius:30px;background:#fff;font-family:'Fredoka One',cursive;font-size:1rem;color:var(--text);cursor:pointer;transition:all .2s;}
.word-pill.picked{background:var(--purple);color:#fff;border-color:var(--purple);}
.word-pill:hover{border-color:var(--purple);}

/* GAME 14: STORY STARTER */
.story-prompt{background:linear-gradient(135deg,var(--teal),var(--blue));border-radius:16px;padding:20px;font-weight:800;font-size:1.1rem;color:#fff;text-align:center;margin-bottom:16px;}
#storyText{width:100%;padding:14px;border:3px solid var(--blue);border-radius:12px;font-family:'Nunito',sans-serif;font-size:1rem;font-weight:700;min-height:120px;resize:vertical;outline:none;color:var(--text);}
#storyText:focus{border-color:var(--purple);}

/* GAME 15: TAP THE LETTER */
.tap-arena{position:relative;height:380px;border:3px solid #e8e0ff;border-radius:18px;background:linear-gradient(180deg,#f0e8ff,#ffe8f5);overflow:hidden;margin:12px 0;}
.falling-letter{position:absolute;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-family:'Fredoka One',cursive;font-size:1.6rem;cursor:pointer;user-select:none;animation:fall linear forwards;font-weight:900;box-shadow:0 4px 14px rgba(0,0,0,.15);}
@keyframes fall{0%{transform:translateY(-70px);}100%{transform:translateY(420px);}}
.tap-score-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;flex-wrap:wrap;gap:8px;}
.tap-stat{background:#fff;border-radius:12px;padding:8px 16px;font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--text);border:2px solid #e8e0ff;}
.tap-life{font-size:1.4rem;}
#tapTimer{font-family:'Fredoka One',cursive;font-size:1.4rem;color:var(--red);}

/* GAME 16: WHACK-A-WORD */
.whack-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:12px 0;}
.mole-hole{background:linear-gradient(180deg,#8B5E3C,#6B4423);border-radius:50%;aspect-ratio:1;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;cursor:pointer;border:3px solid #5a3516;}
.mole{position:absolute;bottom:-100%;width:85%;background:linear-gradient(135deg,var(--orange),var(--yellow));border-radius:50%;aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-family:'Fredoka One',cursive;font-size:.85rem;color:var(--text);text-align:center;transition:bottom .3s;padding:6px;font-size:clamp(.65rem,2.5vw,.85rem);}
.mole.up{bottom:5%;}
.mole.whacked{bottom:-100%;background:var(--green);}
.whack-score-bar{display:flex;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:8px;}

/* GAME 17: CROSSWORD */
.crossword-grid{display:inline-grid;gap:2px;margin:12px auto;display:block;overflow-x:auto;}
.cw-row{display:flex;gap:2px;}
.cw-cell{width:38px;height:38px;border:2px solid #c8b8ff;background:#fff;display:flex;align-items:center;justify-content:center;font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--text);position:relative;border-radius:4px;}
.cw-cell.black{background:#3D2C8D;border-color:#3D2C8D;}
.cw-cell.active{border-color:var(--pink);background:#fff0f5;}
.cw-cell.correct{background:#d4f8e5;border-color:var(--green);}
.cw-cell input{width:100%;height:100%;border:none;background:transparent;text-align:center;font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--text);outline:none;text-transform:uppercase;cursor:pointer;}
.cw-num{position:absolute;top:1px;left:3px;font-size:.48rem;font-family:'Nunito',sans-serif;font-weight:800;color:#999;line-height:1;}
.cw-clues{margin-top:14px;}
.cw-clues h4{font-family:'Fredoka One',cursive;color:var(--text);font-size:1.1rem;margin-bottom:8px;}
.cw-clue{display:flex;gap:8px;align-items:center;margin-bottom:6px;font-weight:700;font-size:.9rem;color:#555;}
.cw-clue span{background:var(--purple);color:#fff;border-radius:6px;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-family:'Fredoka One',cursive;font-size:.85rem;flex-shrink:0;}

/* GAME 18: WORD SEARCH */
.ws-grid{display:inline-grid;gap:2px;margin:0 auto 14px;width:100%;max-width:360px;}
.ws-row{display:flex;gap:2px;justify-content:center;}
.ws-cell{width:calc(min(36px,(100vw - 80px)/9));height:calc(min(36px,(100vw - 80px)/9));border:2px solid #e8e0ff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-family:'Fredoka One',cursive;font-size:.9rem;color:var(--text);cursor:pointer;user-select:none;background:#fff;transition:all .15s;}
.ws-cell.selected{background:var(--yellow);border-color:var(--orange);}
.ws-cell.found{background:var(--green);border-color:#2ecc71;color:#155724;}
.ws-words{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;}
.ws-word{padding:6px 14px;border:2px solid #e8e0ff;border-radius:20px;font-weight:800;font-size:.9rem;color:var(--text);background:#fff;}
.ws-word.found{background:var(--green);border-color:#2ecc71;color:#155724;text-decoration:line-through;}

/* GAME 19: STICKER BOOK */
.sticker-book{display:grid;grid-template-columns:repeat(auto-fill,minmax(72px,1fr));gap:10px;margin:14px 0;}
.sticker-slot{aspect-ratio:1;border:3px dashed #e8e0ff;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-size:2rem;background:#faf5ff;transition:all .3s;}
.sticker-slot.earned{background:linear-gradient(135deg,#fff0f5,#f0e8ff);border-style:solid;border-color:var(--purple);animation:pop .4s ease;}
@keyframes pop{0%{transform:scale(0);}60%{transform:scale(1.2);}100%{transform:scale(1);}}
.sticker-slot .sl{font-size:.7rem;font-weight:800;color:var(--purple);margin-top:2px;}
.sticker-progress{background:#f0e8ff;border-radius:12px;height:14px;margin-bottom:14px;overflow:hidden;}
.sticker-fill{background:linear-gradient(90deg,var(--purple),var(--pink));height:100%;border-radius:12px;transition:width .6s ease;}

/* GAME 20: BINGO */
.bingo-card{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;max-width:300px;margin:12px auto;}
.bingo-cell{aspect-ratio:1;border:3px solid #e8e0ff;border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#fff;cursor:pointer;transition:all .2s;text-align:center;padding:6px;}
.bingo-cell .bc-emoji{font-size:1.6rem;}
.bingo-cell .bc-word{font-family:'Fredoka One',cursive;font-size:.7rem;color:var(--text);margin-top:3px;}
.bingo-cell.marked{background:linear-gradient(135deg,var(--yellow),var(--orange));border-color:var(--orange);}
.bingo-cell.bingo-winner{background:linear-gradient(135deg,var(--green),var(--teal));border-color:#2ecc71;animation:pop .4s ease;}
.bingo-caller{background:linear-gradient(135deg,var(--purple),var(--blue));border-radius:16px;padding:20px;text-align:center;margin-bottom:14px;cursor:pointer;}
.bingo-caller h3{font-family:'Fredoka One',cursive;font-size:1.5rem;color:#fff;}
.bingo-caller p{color:rgba(255,255,255,.8);font-size:.85rem;font-weight:700;}

/* CONFETTI */
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;}
.confetti-piece{position:absolute;top:-10px;animation:confettiFall linear forwards;border-radius:2px;}
@keyframes confettiFall{to{transform:translateY(110vh) rotate(720deg);opacity:0;}}

@media(max-width:480px){
  .act-card{padding:16px 14px;}
  .tabs{gap:0;}
  .tab{padding:9px 9px;font-size:.65rem;}
  .tab .ti{font-size:1.1rem;}
  .memory-grid{grid-template-columns:repeat(3,1fr);}
  .sound-choices{grid-template-columns:repeat(2,1fr);}
}
</style>
</head>
<body>

<div class="bubbles" id="bubbles"></div>

<!-- HOME -->
<div id="home" class="page">
  <div class="home-logo">Phonics Fun! ğŸŒŸ</div>
  <p class="home-subtitle">19 fun activities to learn letter sounds!</p>
  <div class="input-card">
    <label for="phonicInput">âœï¸ Type a Phonic Letter (Aâ€“Z):</label>
    <input type="text" id="phonicInput" class="letter-input" maxlength="2" placeholder="A" autocomplete="off"/>
    <button class="start-btn" onclick="startActivities()">Let's Go! ğŸš€</button>
  </div>
  <div class="emoji-row">ğŸŠ ğŸ¦ ğŸ˜ ğŸ¦’ ğŸ§ ğŸ¦‹ ğŸ¯ ğŸª</div>
</div>

<!-- ACTIVITIES -->
<div id="activities" class="page">
  <div class="act-header">
    <button class="back-btn" onclick="goHome()">â†</button>
    <h1>Phonics Fun!</h1>
    <div class="letter-badge" id="headerLetter">A</div>
  </div>

  <div class="tabs-wrapper">
    <div class="tabs" id="tabsBar">
      <button class="tab active" onclick="switchTab(0)"><span class="ti">ğŸ”Š</span>Say It</button>
      <button class="tab" onclick="switchTab(1)"><span class="ti">âœï¸</span>Trace</button>
      <button class="tab" onclick="switchTab(2)"><span class="ti">â­•</span>Circle</button>
      <button class="tab" onclick="switchTab(3)"><span class="ti">â“</span>Fill In</button>
      <button class="tab" onclick="switchTab(4)"><span class="ti">ğŸ¨</span>Draw</button>
      <button class="tab" onclick="switchTab(5)"><span class="ti">ğŸ‘‚</span>Listen</button>
      <button class="tab" onclick="switchTab(6)"><span class="ti">ğŸ§±</span>Build</button>
      <button class="tab" onclick="switchTab(7)"><span class="ti">ğŸ”€</span>Scramble</button>
      <button class="tab" onclick="switchTab(8)"><span class="ti">ğŸƒ</span>Memory</button>
      <button class="tab" onclick="switchTab(9)"><span class="ti">ğŸµ</span>S.Match</button>
      <button class="tab" onclick="switchTab(10)"><span class="ti">ğŸ—‚ï¸</span>Sort</button>
      <button class="tab" onclick="switchTab(11)"><span class="ti">ğŸ“</span>Position</button>
      <button class="tab" onclick="switchTab(12)"><span class="ti">ğŸ˜‚</span>Sentence</button>
      <button class="tab" onclick="switchTab(13)"><span class="ti">ğŸ“–</span>Story</button>
      <button class="tab" onclick="switchTab(14)"><span class="ti">âš¡</span>Tap!</button>
      <button class="tab" onclick="switchTab(15)"><span class="ti">ğŸ”¨</span>Whack!</button>
      <button class="tab" onclick="switchTab(16)"><span class="ti">âœï¸</span>Crossword</button>
      <button class="tab" onclick="switchTab(17)"><span class="ti">ğŸ”</span>W.Search</button>
      <button class="tab" onclick="switchTab(18)"><span class="ti">â­</span>Stickers</button>
    </div>
  </div>

  <!-- PANEL 0: SAY SOUND -->
  <div class="activity-panel active" id="panel0">
    <div class="act-card" style="text-align:center;">
      <div class="act-title">ğŸ”Š Say the Sound!</div>
      <div class="act-desc">Listen, then say the sound yourself!</div>
      <div class="big-letter" id="soundLetter">A</div>
      <p id="soundExample" style="font-size:1.1rem;font-weight:800;color:#888;margin:6px 0 16px;">like in ğŸ Apple</p>
      <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-bottom:14px;">
        <button class="btn btn-blue" onclick="speakPhonic()">ğŸ”Š Hear Sound</button>
        <button class="btn btn-pink" id="recordBtn" onclick="toggleRecording()">ğŸ¤ Say It!</button>
      </div>
      <div class="sound-status status-neutral" id="soundStatus">Press "Hear Sound" first, then say the sound!</div>
      <div class="stars" id="starsDisplay"></div>
    </div>
  </div>

  <!-- PANEL 1: TRACE -->
  <div class="activity-panel" id="panel1">
    <div class="act-card">
      <div class="act-title">âœï¸ Trace the Letter!</div>
      <div class="act-desc">Trace the dotted letter with your finger!</div>
      <canvas id="traceCanvas" width="400" height="300"></canvas>
      <div class="trace-controls">
        <button class="btn btn-purple btn-sm" onclick="clearTrace()">ğŸ”„ Clear</button>
        <button class="btn btn-green btn-sm" onclick="checkTrace()">âœ… Done!</button>
      </div>
    </div>
  </div>

  <!-- PANEL 2: CIRCLE WORDS -->
  <div class="activity-panel" id="panel2">
    <div class="act-card">
      <div class="act-title">â­• Circle the Words!</div>
      <div class="act-desc" id="circleDesc">Tap all words that have the letter!</div>
      <div class="word-grid" id="wordGrid"></div>
      <div id="circleResult" style="display:none;padding:12px;border-radius:12px;text-align:center;font-weight:800;margin-top:12px;"></div>
      <button class="btn btn-purple btn-full" onclick="generateCircleWords()">ğŸ”„ New Words</button>
    </div>
  </div>

  <!-- PANEL 3: FILL MISSING -->
  <div class="activity-panel" id="panel3">
    <div class="act-card">
      <div class="act-title">â“ Fill the Missing Sound!</div>
      <div class="act-desc">Tap the correct letter to complete the word!</div>
      <div id="fillHint" style="text-align:center;font-size:3rem;margin:8px 0;"></div>
      <div id="fillWordDisplay" class="fill-word"></div>
      <div class="options-grid" id="fillOptions"></div>
      <div id="fillResult" class="sound-status" style="display:none;margin-top:12px;"></div>
      <button class="btn btn-blue btn-full" onclick="nextFillWord()">â¡ï¸ Next Word</button>
    </div>
  </div>

  <!-- PANEL 4: DRAW -->
  <div class="activity-panel" id="panel4">
    <div class="act-card">
      <div class="act-title">ğŸ¨ Draw Something!</div>
      <div class="draw-prompt" id="drawPrompt">Draw something that starts with the letter!</div>
      <div class="draw-toolbar">
        <div class="color-dot active" style="background:#3D2C8D;" data-color="#3D2C8D" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#FF6B9D;" data-color="#FF6B9D" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#4FC3F7;" data-color="#4FC3F7" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#69E090;" data-color="#69E090" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#FFA552;" data-color="#FFA552" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#FFD93D;" data-color="#FFD93D" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#FF4757;" data-color="#FF4757" onclick="setColor(this)"></div>
        <div class="color-dot" style="background:#fff;border:2px solid #ddd;" data-color="#ffffff" onclick="setColor(this)"></div>
        <label style="font-weight:800;font-size:.8rem;color:var(--text);">Size:</label>
        <input type="range" min="2" max="20" value="5" class="size-slider" id="brushSize" oninput="brushSz=this.value">
      </div>
      <canvas id="drawCanvas" width="480" height="340"></canvas>
      <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;justify-content:center;">
        <button class="btn btn-pink btn-sm" onclick="clearDraw()">ğŸ—‘ï¸ Clear</button>
        <button class="btn btn-green btn-sm" onclick="saveDraw()">ğŸ’¾ Save</button>
      </div>
    </div>
  </div>

  <!-- PANEL 5: LISTEN -->
  <div class="activity-panel" id="panel5">
    <div class="act-card">
      <div class="act-title">ğŸ‘‚ Listen & Learn!</div>
      <div class="act-desc">Tap each card to hear the word!</div>
      <div class="listen-grid" id="listenGrid"></div>
      <button class="btn btn-orange btn-full" onclick="playAllWords()">â–¶ï¸ Play All Words</button>
    </div>
  </div>

  <!-- PANEL 6: WORD BUILDER -->
  <div class="activity-panel" id="panel6">
    <div class="act-card">
      <div class="act-title">ğŸ§± Build a Word!</div>
      <div class="act-desc">Drag the letter tiles to spell the word!</div>
      <div class="word-hint-img" id="builderEmoji"></div>
      <p style="text-align:center;font-weight:800;color:#888;font-size:.9rem;margin-bottom:10px;">Spell this word â†‘ using the tiles below</p>
      <div class="drop-zone" id="dropZone"></div>
      <div class="tile-bank" id="tileBankEl"></div>
      <div class="builder-result" id="builderResult" style="display:none;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px;">
        <button class="btn btn-purple btn-sm" onclick="resetBuilder()">ğŸ”„ Reset</button>
        <button class="btn btn-green btn-sm" onclick="checkBuilder()">âœ… Check!</button>
        <button class="btn btn-blue btn-sm" onclick="nextBuilder()">â¡ï¸ Next Word</button>
      </div>
    </div>
  </div>

  <!-- PANEL 7: ANAGRAM -->
  <div class="activity-panel" id="panel7">
    <div class="act-card">
      <div class="act-title">ğŸ”€ Word Scramble!</div>
      <div class="act-desc">Unscramble the letters to spell the word!</div>
      <div id="anagramEmoji" style="text-align:center;font-size:3.5rem;margin:10px 0;"></div>
      <div class="anagram-display" id="anagramDisplay"></div>
      <p style="text-align:center;font-weight:700;color:#aaa;font-size:.9rem;margin-bottom:10px;">Unscramble the letters above â†‘</p>
      <input type="text" class="anagram-input" id="anagramInput" maxlength="12" placeholder="Type your answer..." oninput="this.value=this.value.toUpperCase()" onkeydown="if(event.key==='Enter')checkAnagram()"/>
      <div class="sound-status status-neutral" id="anagramResult" style="margin-top:12px;display:none;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
        <button class="btn btn-pink btn-sm" onclick="checkAnagram()">âœ… Check!</button>
        <button class="btn btn-blue btn-sm" onclick="nextAnagram()">â¡ï¸ Next</button>
        <button class="btn btn-yellow btn-sm" onclick="hintAnagram()">ğŸ’¡ Hint</button>
      </div>
    </div>
  </div>

  <!-- PANEL 8: MEMORY -->
  <div class="activity-panel" id="panel8">
    <div class="act-card">
      <div class="act-title">ğŸƒ Memory Match!</div>
      <div class="act-desc">Match each picture to its word!</div>
      <div class="mem-score">Pairs: <span id="memPairs">0</span>/5 &nbsp;|&nbsp; Tries: <span id="memTries">0</span></div>
      <div class="memory-grid" id="memoryGrid"></div>
      <button class="btn btn-purple btn-full" onclick="initMemory()">ğŸ”„ New Game</button>
    </div>
  </div>

  <!-- PANEL 9: SOUND MATCH -->
  <div class="activity-panel" id="panel9">
    <div class="act-card">
      <div class="act-title">ğŸµ Sound Match!</div>
      <div class="act-desc">Hear the word, then tap the right picture!</div>
      <div class="sound-question" id="soundMatchQ" onclick="playSoundMatchWord()">
        <h3>ğŸ”Š Tap to Hear the Word!</h3>
        <p>Listen carefully, then pick the right picture below</p>
      </div>
      <div class="sound-choices" id="soundChoices"></div>
      <div class="sound-status status-neutral" id="soundMatchResult" style="display:none;margin-top:10px;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
        <div style="font-family:'Fredoka One',cursive;font-size:1.1rem;color:var(--text);">Score: <span id="smScore">0</span></div>
      </div>
    </div>
  </div>

  <!-- PANEL 10: SORTING BIN -->
  <div class="activity-panel" id="panel10">
    <div class="act-card">
      <div class="act-title">ğŸ—‚ï¸ Sorting Bin!</div>
      <div class="act-desc" id="sortDesc">Sort words into the correct bin!</div>
      <div class="sort-arena" id="sortArena">
        <div class="sort-word-card" id="sortCard" draggable="true">WORD</div>
      </div>
      <div class="sort-bins">
        <div class="sort-bin has-letter" id="binYes" ondrop="dropSort(event,'yes')" ondragover="allowDrop(event)">
          <h3 style="color:var(--teal);">âœ… Has "<span id="binLetter">A</span>"</h3>
          <div class="sort-bin-items" id="binYesItems"></div>
        </div>
        <div class="sort-bin no-letter" id="binNo" ondrop="dropSort(event,'no')" ondragover="allowDrop(event)">
          <h3 style="color:var(--pink);">âŒ No "<span id="binLetter2">A</span>"</h3>
          <div class="sort-bin-items" id="binNoItems"></div>
        </div>
      </div>
      <div id="sortResult" class="sound-status" style="display:none;margin-top:12px;"></div>
      <button class="btn btn-blue btn-full" onclick="nextSortWord()">â¡ï¸ Next Word</button>
    </div>
    <!-- Touch sort buttons -->
    <div class="act-card" style="display:none;" id="sortTouchPanel">
      <p style="font-weight:700;color:#888;text-align:center;margin-bottom:10px;">Tap a bin to sort:</p>
      <div style="display:flex;gap:10px;justify-content:center;">
        <button class="btn btn-green" onclick="touchSort('yes')">âœ… Has Letter</button>
        <button class="btn btn-pink" onclick="touchSort('no')">âŒ No Letter</button>
      </div>
    </div>
  </div>

  <!-- PANEL 11: POSITION SORT -->
  <div class="activity-panel" id="panel11">
    <div class="act-card">
      <div class="act-title">ğŸ“ Where's the Letter?</div>
      <div class="act-desc">Tell us where the highlighted letter is!</div>
      <div id="posHint" style="text-align:center;font-size:3rem;margin:8px 0;"></div>
      <div class="pos-word-display" id="posWord"></div>
      <p style="text-align:center;font-weight:700;color:#888;font-size:.95rem;">Where is the <strong style="color:var(--pink);">pink letter</strong>?</p>
      <div class="pos-choices">
        <button class="pos-btn" data-pos="beginning" onclick="checkPosition('beginning')">ğŸ Beginning</button>
        <button class="pos-btn" data-pos="middle" onclick="checkPosition('middle')">ğŸ¯ Middle</button>
        <button class="pos-btn" data-pos="end" onclick="checkPosition('end')">ğŸ† End</button>
      </div>
      <div class="sound-status status-neutral" id="posResult" style="display:none;margin-top:12px;"></div>
      <button class="btn btn-blue btn-full" onclick="nextPositionWord()">â¡ï¸ Next Word</button>
    </div>
  </div>

  <!-- PANEL 12: SILLY SENTENCE -->
  <div class="activity-panel" id="panel12">
    <div class="act-card">
      <div class="act-title">ğŸ˜‚ Silly Sentence!</div>
      <div class="act-desc">Pick one word from each group to make a funny sentence!</div>
      <div id="wordSelectGroups"></div>
      <div class="sentence-display" id="sentenceDisplay">Pick words above to build your sentence! ğŸ˜„</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px;">
        <button class="btn btn-blue btn-sm" onclick="readSillyS()">ğŸ”Š Read It!</button>
        <button class="btn btn-purple btn-sm" onclick="buildSillyS()">ğŸ”„ New Sentence</button>
      </div>
    </div>
  </div>

  <!-- PANEL 13: STORY STARTER -->
  <div class="activity-panel" id="panel13">
    <div class="act-card">
      <div class="act-title">ğŸ“– Story Starter!</div>
      <div class="act-desc">Finish the story and then record yourself reading it!</div>
      <div class="story-prompt" id="storyPrompt">Loading story starter...</div>
      <textarea id="storyText" placeholder="Type your story here... ğŸ“"></textarea>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
        <button class="btn btn-blue btn-sm" onclick="readMyStory()">ğŸ”Š Read My Story</button>
        <button class="btn btn-pink btn-sm" id="storyRecBtn" onclick="toggleStoryRec()">ğŸ¤ Record Me!</button>
        <button class="btn btn-purple btn-sm" onclick="nextStory()">ğŸ“– New Starter</button>
      </div>
      <div class="sound-status status-neutral" id="storyStatus" style="margin-top:12px;display:none;"></div>
    </div>
  </div>

  <!-- PANEL 14: TAP LETTER -->
  <div class="activity-panel" id="panel14">
    <div class="act-card">
      <div class="act-title">âš¡ Tap the Letter!</div>
      <div class="act-desc" id="tapDesc">Tap only the falling target letter!</div>
      <div class="tap-score-bar">
        <div class="tap-stat">â­ <span id="tapScore">0</span></div>
        <div class="tap-stat" id="tapTimer">â±ï¸ 30s</div>
        <div class="tap-stat"><span id="tapLives" class="tap-life">â¤ï¸â¤ï¸â¤ï¸</span></div>
      </div>
      <div class="tap-arena" id="tapArena"></div>
      <div id="tapResult" style="display:none;" class="sound-status status-success"></div>
      <button class="btn btn-orange btn-full" id="tapStartBtn" onclick="startTapGame()">ğŸš€ Start Game!</button>
    </div>
  </div>

  <!-- PANEL 15: WHACK A WORD -->
  <div class="activity-panel" id="panel15">
    <div class="act-card">
      <div class="act-title">ğŸ”¨ Whack-a-Word!</div>
      <div class="act-desc" id="whackDesc">Whack the moles that show words with the letter!</div>
      <div class="whack-score-bar">
        <div class="tap-stat">â­ <span id="whackScore">0</span></div>
        <div class="tap-stat" id="whackTimer">â±ï¸ 45s</div>
        <div class="tap-stat"><span id="whackLives" class="tap-life">â¤ï¸â¤ï¸â¤ï¸</span></div>
      </div>
      <div class="whack-grid" id="whackGrid"></div>
      <div id="whackResult" style="display:none;" class="sound-status status-success"></div>
      <button class="btn btn-orange btn-full" id="whackStartBtn" onclick="startWhack()">ğŸ”¨ Start Whacking!</button>
    </div>
  </div>

  <!-- PANEL 16: CROSSWORD -->
  <div class="activity-panel" id="panel16">
    <div class="act-card">
      <div class="act-title">âœï¸ Mini Crossword!</div>
      <div class="act-desc">Fill in the crossword using the picture clues!</div>
      <div style="overflow-x:auto;" id="cwContainer"></div>
      <div class="cw-clues" id="cwClues"></div>
      <div class="sound-status status-neutral" id="cwResult" style="display:none;margin-top:10px;"></div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
        <button class="btn btn-green btn-sm" onclick="checkCrossword()">âœ… Check!</button>
        <button class="btn btn-purple btn-sm" onclick="initCrossword()">ğŸ”„ New Puzzle</button>
      </div>
    </div>
  </div>

  <!-- PANEL 17: WORD SEARCH -->
  <div class="activity-panel" id="panel17">
    <div class="act-card">
      <div class="act-title">ğŸ” Word Search!</div>
      <div class="act-desc">Find all the hidden words in the grid!</div>
      <div id="wsGridContainer" style="text-align:center;overflow-x:auto;"></div>
      <div class="ws-words" id="wsWordList"></div>
      <div class="sound-status status-neutral" id="wsResult" style="display:none;margin-top:10px;"></div>
      <button class="btn btn-purple btn-full" onclick="initWordSearch()">ğŸ”„ New Puzzle</button>
    </div>
  </div>

  <!-- PANEL 18: STICKERS -->
  <div class="activity-panel" id="panel18">
    <div class="act-card">
      <div class="act-title">â­ My Sticker Book!</div>
      <div class="act-desc">Complete activities to earn stickers!</div>
      <div class="sticker-progress"><div class="sticker-fill" id="stickerFill" style="width:0%"></div></div>
      <div class="sticker-book" id="stickerBook"></div>
      <button class="btn btn-yellow btn-full" onclick="earnSticker()">ğŸŒŸ Earn a Sticker! (Test)</button>
    </div>
    <div class="act-card">
      <div class="act-title">ğŸ° Phonic Bingo!</div>
      <div class="act-desc">Tap the mole when you hear its word!</div>
      <div class="bingo-caller" id="bingoCaller" onclick="callBingo()">
        <h3 id="bingoCallText">ğŸ¯ Tap to Call a Word!</h3>
        <p>Listen to the word, then find it on your card</p>
      </div>
      <div class="bingo-card" id="bingoCard"></div>
      <div class="sound-status status-neutral" id="bingoResult" style="display:none;"></div>
      <button class="btn btn-purple btn-full" onclick="initBingo()">ğŸ”„ New Bingo Card</button>
    </div>
  </div>

</div>

<div class="confetti-container" id="confetti"></div>

<script>
// ============================================================
// DATA
// ============================================================
const PD = {
  A:{sound:"aah",example:"Apple ğŸ",words:["apple","ant","arrow","arm","axe"],emojis:["ğŸ","ğŸœ","â¡ï¸","ğŸ’ª","ğŸª“"]},
  B:{sound:"buh",example:"Ball âš½",words:["ball","bear","bird","boat","banana"],emojis:["âš½","ğŸ»","ğŸ¦","â›µ","ğŸŒ"]},
  C:{sound:"kuh",example:"Cat ğŸ±",words:["cat","car","cake","cup","cow"],emojis:["ğŸ±","ğŸš—","ğŸ‚","ğŸ¥¤","ğŸ®"]},
  D:{sound:"duh",example:"Dog ğŸ¶",words:["dog","duck","drum","door","deer"],emojis:["ğŸ¶","ğŸ¦†","ğŸ¥","ğŸšª","ğŸ¦Œ"]},
  E:{sound:"eh",example:"Elephant ğŸ˜",words:["egg","ear","eagle","elf","eye"],emojis:["ğŸ¥š","ğŸ‘‚","ğŸ¦…","ğŸ§","ğŸ‘ï¸"]},
  F:{sound:"fuh",example:"Fish ğŸŸ",words:["fish","frog","fan","fox","flag"],emojis:["ğŸŸ","ğŸ¸","ğŸ’¨","ğŸ¦Š","ğŸš©"]},
  G:{sound:"guh",example:"Goat ğŸ",words:["goat","grapes","gift","gem","ghost"],emojis:["ğŸ","ğŸ‡","ğŸ","ğŸ’","ğŸ‘»"]},
  H:{sound:"huh",example:"Hat ğŸ©",words:["hat","horse","heart","hen","horn"],emojis:["ğŸ©","ğŸ´","â¤ï¸","ğŸ”","ğŸ“¯"]},
  I:{sound:"ih",example:"Igloo ğŸ ",words:["igloo","ink","iron","ice","ivy"],emojis:["ğŸ ","ğŸ–Šï¸","ğŸª¢","ğŸ§Š","ğŸŒ¿"]},
  J:{sound:"juh",example:"Jar ğŸ«™",words:["jar","jet","jump","jam","jug"],emojis:["ğŸ«™","âœˆï¸","ğŸ¦˜","ğŸ“","ğŸº"]},
  K:{sound:"kuh",example:"Kite ğŸª",words:["kite","king","key","kit","kiwi"],emojis:["ğŸª","ğŸ‘‘","ğŸ”‘","ğŸ§°","ğŸ¥"]},
  L:{sound:"luh",example:"Lion ğŸ¦",words:["lion","leaf","lamp","log","lime"],emojis:["ğŸ¦","ğŸƒ","ğŸ’¡","ğŸªµ","ğŸ‹"]},
  M:{sound:"muh",example:"Moon ğŸŒ™",words:["moon","map","milk","mop","mask"],emojis:["ğŸŒ™","ğŸ—ºï¸","ğŸ¥›","ğŸ§¹","ğŸ˜·"]},
  N:{sound:"nuh",example:"Nest ğŸªº",words:["nest","nose","net","nut","nail"],emojis:["ğŸªº","ğŸ‘ƒ","ğŸ•¸ï¸","ğŸ¥œ","ğŸ”©"]},
  O:{sound:"oh",example:"Octopus ğŸ™",words:["owl","ox","oak","oar","oven"],emojis:["ğŸ¦‰","ğŸ‚","ğŸŒ³","ğŸš£","ğŸ”¥"]},
  P:{sound:"puh",example:"Pizza ğŸ•",words:["pig","pan","pen","pie","paw"],emojis:["ğŸ·","ğŸ³","âœï¸","ğŸ¥§","ğŸ¾"]},
  Q:{sound:"kwuh",example:"Queen ğŸ‘‘",words:["queen","quilt","quiz","quack","quest"],emojis:["ğŸ‘‘","ğŸ›ï¸","ğŸ“","ğŸ¦†","ğŸ—ºï¸"]},
  R:{sound:"ruh",example:"Rainbow ğŸŒˆ",words:["rainbow","rabbit","rose","rug","rock"],emojis:["ğŸŒˆ","ğŸ°","ğŸŒ¹","ğŸª¸","ğŸª¨"]},
  S:{sound:"suh",example:"Sun â˜€ï¸",words:["sun","star","sock","seal","soup"],emojis:["â˜€ï¸","â­","ğŸ§¦","ğŸ¦­","ğŸœ"]},
  T:{sound:"tuh",example:"Tiger ğŸ¯",words:["tiger","tree","tent","tail","toad"],emojis:["ğŸ¯","ğŸŒ²","â›º","ğŸˆ","ğŸ¸"]},
  U:{sound:"uh",example:"Umbrella â˜‚ï¸",words:["umbrella","up","uncle","urge","use"],emojis:["â˜‚ï¸","â¬†ï¸","ğŸ‘¨","ğŸ“¢","ğŸ”§"]},
  V:{sound:"vuh",example:"Volcano ğŸŒ‹",words:["van","vest","vine","vase","vow"],emojis:["ğŸš","ğŸ¦º","ğŸ‡","ğŸº","ğŸ’"]},
  W:{sound:"wuh",example:"Whale ğŸ³",words:["whale","wolf","web","wig","wand"],emojis:["ğŸ³","ğŸº","ğŸ•¸ï¸","ğŸ’ˆ","ğŸª„"]},
  X:{sound:"ks",example:"X-Ray ğŸ¦´",words:["x-ray","box","fox","wax","six"],emojis:["ğŸ¦´","ğŸ“¦","ğŸ¦Š","ğŸ•¯ï¸","6ï¸âƒ£"]},
  Y:{sound:"yuh",example:"Yak ğŸƒ",words:["yak","yarn","yell","yawn","yam"],emojis:["ğŸƒ","ğŸ§¶","ğŸ“¢","ğŸ˜®","ğŸ "]},
  Z:{sound:"zuh",example:"Zebra ğŸ¦“",words:["zebra","zero","zoom","zap","zone"],emojis:["ğŸ¦“","0ï¸âƒ£","ğŸ”","âš¡","ğŸ—ºï¸"]}
};

let CL='A',PH=PD['A'];
let isRecording=false,recognition=null;
let fillIdx=0;
let drawColor='#3D2C8D',brushSz=5;
let builderIdx=0,builderWord='';
let anagramIdx=0;
let memFlipped=[],memMatched=0,memTries=0,memLock=false;
let smCurrentWord='',smScore=0;
let sortWords=[],sortIdx=0;
let posWords=[],posIdx=0;
let sillyGroups=[],sillyPicks=[];
let storyIdx=0;
let tapScore=0,tapLives=3,tapInterval=null,tapCountdown=null,tapActive=false;
let whackScore=0,whackLives=3,whackActive=false,whackInterval=null,whackCountdown=null;
let cwData=null;
let wsGrid=[],wsWords=[],wsSelected=[],wsFoundCells=new Set(),wsFoundWords=[];
let stickerCount=0;
let bingoCard=[],bingoCalled=[],bingoCallIdx=0;
let storyRecognition=null,storyRecording=false;

// ============================================================
// SETUP
// ============================================================
function genBubbles(){
  const c=document.getElementById('bubbles');
  const cols=['#FF6B9D','#FFD93D','#4FC3F7','#69E090','#B388FF','#FFA552'];
  for(let i=0;i<16;i++){
    const b=document.createElement('div');b.className='bubble';
    const sz=20+Math.random()*55;
    b.style.cssText=`width:${sz}px;height:${sz}px;left:${Math.random()*100}%;background:${cols[Math.floor(Math.random()*cols.length)]};animation-duration:${7+Math.random()*12}s;animation-delay:${Math.random()*8}s;`;
    c.appendChild(b);
  }
}
genBubbles();

function startActivities(){
  const v=document.getElementById('phonicInput').value.trim().toUpperCase();
  if(!v||!PD[v]){
    const el=document.getElementById('phonicInput');
    el.style.borderColor='var(--red)';el.placeholder='Try A-Z!';
    setTimeout(()=>{el.style.borderColor='';},800);return;
  }
  CL=v;PH=PD[CL];
  document.getElementById('home').style.display='none';
  document.getElementById('activities').style.display='block';
  initAll();
}
function goHome(){
  stopTapGame();stopWhack();
  document.getElementById('activities').style.display='none';
  document.getElementById('home').style.display='flex';
}
function switchTab(i){
  document.querySelectorAll('.tab').forEach((t,j)=>t.classList.toggle('active',i===j));
  document.querySelectorAll('.activity-panel').forEach((p,j)=>p.classList.toggle('active',i===j));
  // scroll active tab into view
  const tabs=document.querySelectorAll('.tab');
  if(tabs[i]) tabs[i].scrollIntoView({behavior:'smooth',block:'nearest',inline:'center'});
}
document.getElementById('phonicInput').addEventListener('keydown',e=>{if(e.key==='Enter')startActivities();});

function initAll(){
  document.getElementById('headerLetter').textContent=CL;
  // Panel 0
  document.getElementById('soundLetter').textContent=CL;
  document.getElementById('soundExample').textContent=`like in ${PH.example}`;
  document.getElementById('soundStatus').textContent='Press "Hear Sound" first, then say the sound!';
  document.getElementById('soundStatus').className='sound-status status-neutral';
  document.getElementById('starsDisplay').textContent='';
  // Panel 1
  initTrace();
  // Panel 2
  document.getElementById('circleDesc').textContent=`Tap all words that contain the letter "${CL}"!`;
  generateCircleWords();
  // Panel 3
  fillIdx=0;loadFillWord();
  // Panel 4
  initDraw();
  // Panel 5
  generateListenGrid();
  // Panel 6
  builderIdx=0;loadBuilderWord();
  // Panel 7
  anagramIdx=0;loadAnagram();
  // Panel 8
  initMemory();
  // Panel 9
  smScore=0;document.getElementById('smScore').textContent=0;loadSoundMatch();
  // Panel 10
  initSortBins();
  // Panel 11
  posIdx=0;nextPositionWord();
  // Panel 12
  buildSillyS();
  // Panel 13
  storyIdx=0;loadStory();
  // Panel 14
  resetTapUI();
  // Panel 15
  resetWhackUI();
  // Panel 16
  initCrossword();
  // Panel 17
  initWordSearch();
  // Panel 18
  initStickerBook();initBingo();
  // sort touch panel
  if('ontouchstart' in window){document.getElementById('sortTouchPanel').style.display='block';}
}

// ============================================================
// ACT 1: SAY SOUND
// ============================================================
function speakPhonic(){
  const u=new SpeechSynthesisUtterance(`The sound of the letter ${CL} is ${PH.sound}. Like in ${PH.words[0]}.`);
  u.rate=0.8;u.pitch=1.2;window.speechSynthesis.speak(u);
  setStatus('soundStatus','ğŸ”Š Listen carefully!','neutral');
}
function toggleRecording(){if(isRecording)stopRec();else startRec();}
function startRec(){
  if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window)){simRec();return;}
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  recognition=new SR();recognition.lang='en-US';recognition.continuous=false;recognition.interimResults=false;
  recognition.onstart=()=>{isRecording=true;document.getElementById('recordBtn').textContent='â¹ï¸ Stop';setStatus('soundStatus','ğŸ¤ Listening... say the sound!','recording');};
  recognition.onresult=(e)=>{const t=e.results[0][0].transcript.toLowerCase(),c=e.results[0][0].confidence;rateAttempt(t,c);};
  recognition.onerror=()=>simRec();
  recognition.onend=()=>{isRecording=false;document.getElementById('recordBtn').textContent='ğŸ¤ Say It!';};
  recognition.start();
}
function stopRec(){if(recognition)recognition.stop();isRecording=false;document.getElementById('recordBtn').textContent='ğŸ¤ Say It!';}
function simRec(){
  isRecording=true;document.getElementById('recordBtn').textContent='â¹ï¸ Stop';
  setStatus('soundStatus','ğŸ¤ Listening...','recording');
  setTimeout(()=>{isRecording=false;document.getElementById('recordBtn').textContent='ğŸ¤ Say It!';rateAttempt(PH.sound,0.85);},2500);
}
function rateAttempt(t,c){
  const hit=t.includes(CL.toLowerCase())||t.includes(PH.sound)||c>0.7;
  let stars='',msg='',cls='';
  if(hit&&c>0.8){stars='â­â­â­';msg='ğŸ‰ Amazing! Perfect sound!';cls='success';confettiBurst();}
  else if(hit||c>0.5){stars='â­â­';msg='ğŸ‘ Good try! Almost!';cls='success';}
  else{stars='â­';msg='ğŸ”„ Try again! Listen first.';cls='error';}
  document.getElementById('starsDisplay').textContent=stars;
  setStatus('soundStatus',msg,cls);
  earnStickerIfFirst('sound');
}

// ============================================================
// ACT 2: TRACE
// ============================================================
function initTrace(){
  const c=document.getElementById('traceCanvas');
  const ctx=c.getContext('2d');
  const mw=Math.min(400,window.innerWidth-50);
  c.width=mw;c.height=Math.round(mw*.75);
  drawGuide(ctx,c.width,c.height);
  setupTraceEvents(c,ctx);
}
function drawGuide(ctx,w,h){
  ctx.clearRect(0,0,w,h);
  ctx.fillStyle='#faf6ff';ctx.fillRect(0,0,w,h);
  ctx.save();ctx.setLineDash([8,6]);ctx.strokeStyle='#d0beff';ctx.lineWidth=16;
  ctx.font=`bold ${Math.min(w*.68,h*.82)}px 'Fredoka One',serif`;
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.strokeText(CL,w/2,h/2);ctx.restore();
  ctx.fillStyle='rgba(179,136,255,.07)';
  ctx.font=`bold ${Math.min(w*.68,h*.82)}px 'Fredoka One',serif`;
  ctx.textAlign='center';ctx.textBaseline='middle';
  ctx.fillText(CL,w/2,h/2);
}
let traceStrokes=false;
function setupTraceEvents(c,ctx){
  let dn=false;
  ctx.strokeStyle='#FF6B9D';ctx.lineWidth=7;ctx.lineCap='round';ctx.lineJoin='round';
  const gp=e=>{const r=c.getBoundingClientRect(),s=e.touches?e.touches[0]:e;return{x:s.clientX-r.left,y:s.clientY-r.top};};
  c.addEventListener('mousedown',e=>{dn=true;const p=gp(e);ctx.beginPath();ctx.moveTo(p.x,p.y);traceStrokes=true;});
  c.addEventListener('mousemove',e=>{if(!dn)return;const p=gp(e);ctx.lineTo(p.x,p.y);ctx.stroke();});
  c.addEventListener('mouseup',()=>{dn=false;});
  c.addEventListener('touchstart',e=>{e.preventDefault();dn=true;const p=gp(e);ctx.beginPath();ctx.moveTo(p.x,p.y);traceStrokes=true;},{passive:false});
  c.addEventListener('touchmove',e=>{e.preventDefault();if(!dn)return;const p=gp(e);ctx.lineTo(p.x,p.y);ctx.stroke();},{passive:false});
  c.addEventListener('touchend',e=>{e.preventDefault();dn=false;},{passive:false});
}
function clearTrace(){
  const c=document.getElementById('traceCanvas');
  const ctx=c.getContext('2d');drawGuide(ctx,c.width,c.height);
  ctx.strokeStyle='#FF6B9D';ctx.lineWidth=7;ctx.lineCap='round';traceStrokes=false;
}
function checkTrace(){
  if(!traceStrokes){alert('Trace the letter first! ğŸ˜Š');return;}
  confettiBurst();speak(`Great job tracing the letter ${CL}!`);earnStickerIfFirst('trace');
}

// ============================================================
// ACT 3: CIRCLE WORDS
// ============================================================
const DISTRACTORS=[{w:'dog',e:'ğŸ¶'},{w:'moon',e:'ğŸŒ™'},{w:'boat',e:'â›µ'},{w:'star',e:'â­'},{w:'tree',e:'ğŸŒ²'},{w:'pen',e:'âœï¸'},{w:'fish',e:'ğŸŸ'},{w:'cup',e:'ğŸ¥¤'}];
function generateCircleWords(){
  const correct=PH.words.slice(0,4).map((w,i)=>({w,e:PH.emojis[i],correct:true}));
  const dist=shuffle([...DISTRACTORS]).slice(0,3).map(d=>({...d,correct:!d.w.toUpperCase().includes(CL)}));
  const all=shuffle([...correct,...dist]);
  const grid=document.getElementById('wordGrid');
  grid.innerHTML='';document.getElementById('circleResult').style.display='none';
  all.forEach(item=>{
    const div=document.createElement('div');div.className='word-item';
    div.innerHTML=`<span class="we">${item.e}</span>${item.w}`;
    div.dataset.correct=item.correct;
    div.onclick=function(){
      if(this.classList.contains('selected'))return;
      if(item.correct){this.classList.add('selected');speak(`Yes! ${item.w} has the ${CL} sound!`);checkCircleComplete();}
      else{this.classList.add('wrong');speak('Not quite, try again!');setTimeout(()=>this.classList.remove('wrong'),600);}
    };
    grid.appendChild(div);
  });
}
function checkCircleComplete(){
  const tot=document.querySelectorAll('#wordGrid .word-item[data-correct="true"]').length;
  const sel=document.querySelectorAll('#wordGrid .word-item.selected').length;
  if(sel>=tot){
    const r=document.getElementById('circleResult');
    r.style.display='block';r.style.background='#d4f8e5';r.style.color='#1a7a45';
    r.textContent=`ğŸ‰ Great! You found all ${tot} words with "${CL}"!`;
    confettiBurst();earnStickerIfFirst('circle');
  }
}

// ============================================================
// ACT 4: FILL MISSING
// ============================================================
function loadFillWord(){
  const word=PH.words[fillIdx%PH.words.length];
  const emoji=PH.emojis[fillIdx%PH.emojis.length];
  const idx=word.toUpperCase().indexOf(CL);
  document.getElementById('fillHint').textContent=emoji;
  document.getElementById('fillResult').style.display='none';
  let disp='';
  if(idx>=0){disp=word.slice(0,idx).toUpperCase()+`<span class="fill-blank">?</span>`+word.slice(idx+1).toUpperCase();}
  else{disp=`<span class="fill-blank">?</span>`+word.toUpperCase();}
  document.getElementById('fillWordDisplay').innerHTML=disp;
  const wrong='BCDFGHJKLMNPQRSTVWXYZ'.replace(CL,'').split('').sort(()=>Math.random()-.5).slice(0,3);
  const opts=shuffle([CL,...wrong]);
  const el=document.getElementById('fillOptions');el.innerHTML='';
  opts.forEach(o=>{
    const b=document.createElement('button');b.className='option-btn';b.textContent=o;
    b.onclick=function(){checkFill(o,word,this);};el.appendChild(b);
  });
}
function checkFill(chosen,word,btn){
  const r=document.getElementById('fillResult');r.style.display='block';
  if(chosen===CL){btn.classList.add('correct');setStatus('fillResult',`ğŸ‰ "${word.toUpperCase()}" is correct!`,'success');speak(`Yes! The word is ${word}`);document.querySelectorAll('.option-btn').forEach(b=>b.onclick=null);confettiBurst();earnStickerIfFirst('fill');}
  else{btn.classList.add('incorrect');setStatus('fillResult','âŒ Not quite! Try again!','error');setTimeout(()=>{btn.classList.remove('incorrect');btn.onclick=function(){checkFill(chosen,word,btn);};},600);}
}
function nextFillWord(){fillIdx++;loadFillWord();}

// ============================================================
// ACT 5: DRAW
// ============================================================
function initDraw(){
  const c=document.getElementById('drawCanvas');const ctx=c.getContext('2d');
  const mw=Math.min(480,window.innerWidth-50);c.width=mw;c.height=Math.round(mw*.7);
  ctx.fillStyle='#fff';ctx.fillRect(0,0,c.width,c.height);
  const ps=[`Draw something that starts with ${CL}! ğŸ¨`,`Can you draw a ${PH.words[0]}? ğŸ–Œï¸`,`Draw a ${PH.words[1]}! Be creative! â­`];
  document.getElementById('drawPrompt').textContent=ps[Math.floor(Math.random()*ps.length)];
  let dn=false,lx=0,ly=0;
  const gp=e=>{const r=c.getBoundingClientRect(),s=e.touches?e.touches[0]:e;return{x:(s.clientX-r.left)*(c.width/r.width),y:(s.clientY-r.top)*(c.height/r.height)};};
  c.onmousedown=e=>{dn=true;const p=gp(e);lx=p.x;ly=p.y;};
  c.onmousemove=e=>{if(!dn)return;const p=gp(e);ctx.beginPath();ctx.strokeStyle=drawColor;ctx.lineWidth=brushSz;ctx.lineCap='round';ctx.moveTo(lx,ly);ctx.lineTo(p.x,p.y);ctx.stroke();lx=p.x;ly=p.y;};
  c.onmouseup=()=>{dn=false;};
  c.addEventListener('touchstart',e=>{e.preventDefault();dn=true;const p=gp(e);lx=p.x;ly=p.y;},{passive:false});
  c.addEventListener('touchmove',e=>{e.preventDefault();if(!dn)return;const p=gp(e);ctx.beginPath();ctx.strokeStyle=drawColor;ctx.lineWidth=brushSz;ctx.lineCap='round';ctx.moveTo(lx,ly);ctx.lineTo(p.x,p.y);ctx.stroke();lx=p.x;ly=p.y;},{passive:false});
  c.addEventListener('touchend',e=>{e.preventDefault();dn=false;},{passive:false});
}
function setColor(el){document.querySelectorAll('.color-dot').forEach(d=>d.classList.remove('active'));el.classList.add('active');drawColor=el.dataset.color;}
function clearDraw(){const c=document.getElementById('drawCanvas');const ctx=c.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,c.width,c.height);}
function saveDraw(){const c=document.getElementById('drawCanvas');const a=document.createElement('a');a.download=`my-${CL}-drawing.png`;a.href=c.toDataURL();a.click();speak('Saving your awesome drawing!');confettiBurst();}

// ============================================================
// ACT 6: LISTEN
// ============================================================
function generateListenGrid(){
  const g=document.getElementById('listenGrid');g.innerHTML='';
  PH.words.forEach((w,i)=>{
    const c=document.createElement('div');c.className='listen-card';c.id=`lc${i}`;
    c.innerHTML=`<span class="spk">ğŸ”Š</span><span class="listen-emoji">${PH.emojis[i]}</span><span class="listen-word">${w.toUpperCase()}</span><span class="listen-hint">${hlLetter(w)}</span>`;
    c.onclick=()=>listenWord(w,i);g.appendChild(c);
  });
}
function hlLetter(w){
  const i=w.toUpperCase().indexOf(CL);
  if(i<0)return w;
  return w.slice(0,i)+`[${w[i].toUpperCase()}]`+w.slice(i+1);
}
function listenWord(w,i){
  document.querySelectorAll('.listen-card').forEach(c=>c.classList.remove('playing'));
  const card=document.getElementById(`lc${i}`);if(card)card.classList.add('playing');
  const u=new SpeechSynthesisUtterance(w);u.rate=0.7;u.pitch=1.1;
  u.onend=()=>{if(card)card.classList.remove('playing');};
  window.speechSynthesis.speak(u);
}
let playAllT=null;
function playAllWords(){
  if(playAllT)clearTimeout(playAllT);window.speechSynthesis.cancel();
  let i=0;
  const next=()=>{if(i>=PH.words.length)return;listenWord(PH.words[i],i);i++;playAllT=setTimeout(next,1900);};
  next();
}

// ============================================================
// GAME 7: WORD BUILDER
// ============================================================
function loadBuilderWord(){
  const w=PH.words[builderIdx%PH.words.length];
  const e=PH.emojis[builderIdx%PH.emojis.length];
  builderWord=w.toUpperCase();
  document.getElementById('builderEmoji').textContent=e;
  document.getElementById('dropZone').innerHTML='';
  document.getElementById('builderResult').style.display='none';
  const extras='BCDFGHJKLMNPQRSTVWXYZ'.split('').sort(()=>Math.random()-.5).slice(0,2);
  const tiles=shuffle([...builderWord.split(''),...extras]);
  const bank=document.getElementById('tileBankEl');bank.innerHTML='';
  const makeBankTile=(lt)=>{
    const d=document.createElement('div');d.className='letter-tile';d.textContent=lt;d.draggable=true;
    d.addEventListener('dragstart',ev=>{ev.dataTransfer.setData('text',lt);d.classList.add('dragging');});
    d.addEventListener('dragend',()=>d.classList.remove('dragging'));
    d.addEventListener('click',()=>{bank.removeChild(d);moveTileToZone(lt);});
    return d;
  };
  tiles.forEach(lt=>bank.appendChild(makeBankTile(lt)));
  const dz=document.getElementById('dropZone');
  // Remove old listeners by cloning
  const newDz=dz.cloneNode(false);dz.parentNode.replaceChild(newDz,dz);
  newDz.addEventListener('dragover',e=>{e.preventDefault();newDz.classList.add('drag-over');});
  newDz.addEventListener('dragleave',()=>newDz.classList.remove('drag-over'));
  newDz.addEventListener('drop',ev=>{
    ev.preventDefault();newDz.classList.remove('drag-over');
    const lt=ev.dataTransfer.getData('text');
    // Remove from bank
    const dragging=bank.querySelector('.letter-tile.dragging');
    if(dragging)bank.removeChild(dragging);
    moveTileToZone(lt);
  });
}
function moveTileToZone(lt){
  const dz=document.getElementById('dropZone');
  const newTile=document.createElement('div');newTile.className='letter-tile';newTile.textContent=lt;
  newTile.style.background='linear-gradient(135deg,#d4f8e5,#a8f0c6)';newTile.style.borderColor='#2ecc71';
  newTile.addEventListener('click',()=>{
    // Return tile to bank
    dz.removeChild(newTile);
    const bank=document.getElementById('tileBankEl');
    const retTile=document.createElement('div');retTile.className='letter-tile';retTile.textContent=lt;retTile.draggable=true;
    retTile.addEventListener('dragstart',ev=>{ev.dataTransfer.setData('text',lt);retTile.classList.add('dragging');});
    retTile.addEventListener('dragend',()=>retTile.classList.remove('dragging'));
    retTile.addEventListener('click',()=>moveTileToZone(lt));
    bank.appendChild(retTile);
  });
  dz.appendChild(newTile);
}
function checkBuilder(){
  const dz=document.getElementById('dropZone');
  const formed=[...dz.querySelectorAll('.letter-tile')].map(t=>t.textContent).join('');
  const r=document.getElementById('builderResult');r.style.display='block';
  if(formed===builderWord){
    r.style.background='#d4f8e5';r.style.color='#1a7a45';r.textContent=`ğŸ‰ "${builderWord}" is correct!`;
    speak(`You spelled ${builderWord}!`);confettiBurst();earnStickerIfFirst('builder');
  }else{
    r.style.background='#ffe0e8';r.style.color='#c0284a';
    r.textContent=formed?`âŒ "${formed}" â€” keep trying!`:`âŒ Drop letters into the green zone first!`;
  }
}
function resetBuilder(){
  const dz=document.getElementById('dropZone');dz.innerHTML='';
  loadBuilderWord();
}
function nextBuilder(){builderIdx++;loadBuilderWord();}

// ============================================================
// GAME 8: ANAGRAM
// ============================================================
function loadAnagram(){
  const w=PH.words[anagramIdx%PH.words.length];
  const e=PH.emojis[anagramIdx%PH.emojis.length];
  document.getElementById('anagramEmoji').textContent=e;
  const scrambled=shuffle(w.toUpperCase().split('')).join('  ');
  document.getElementById('anagramDisplay').textContent=scrambled;
  document.getElementById('anagramInput').value='';
  document.getElementById('anagramResult').style.display='none';
}
function checkAnagram(){
  const w=PH.words[anagramIdx%PH.words.length].toUpperCase();
  const ans=document.getElementById('anagramInput').value.trim().toUpperCase();
  const r=document.getElementById('anagramResult');r.style.display='block';
  if(ans===w){setStatus('anagramResult',`ğŸ‰ "${w}" is correct! Well done!`,'success');speak(`Yes! The word is ${PH.words[anagramIdx%PH.words.length]}`);confettiBurst();earnStickerIfFirst('anagram');}
  else{setStatus('anagramResult',`âŒ "${ans}" â€” try again!`,'error');}
}
function nextAnagram(){anagramIdx++;loadAnagram();}
function hintAnagram(){const w=PH.words[anagramIdx%PH.words.length];speak(w);alert(`Hint: starts with "${w[0].toUpperCase()}" and has ${w.length} letters!`);}

// ============================================================
// GAME 9: MEMORY MATCH
// ============================================================
function initMemory(){
  memFlipped=[];memMatched=0;memTries=0;memLock=false;
  document.getElementById('memPairs').textContent=0;
  document.getElementById('memTries').textContent=0;
  const pairs=PH.words.slice(0,5).map((w,i)=>[{type:'emoji',val:PH.emojis[i],word:w},{type:'word',val:w,word:w}]).flat();
  const cards=shuffle(pairs);
  const g=document.getElementById('memoryGrid');g.innerHTML='';
  cards.forEach((card,idx)=>{
    const d=document.createElement('div');d.className='mem-card';d.dataset.idx=idx;d.dataset.word=card.word;
    d.innerHTML=`<div class="mem-front">â“</div><div class="mem-back">${card.type==='emoji'?card.val:`<span style="font-family:'Fredoka One',cursive;font-size:.85rem;color:var(--text);">${card.val.toUpperCase()}</span>`}</div>`;
    d.addEventListener('click',()=>flipMemCard(d,card));
    g.appendChild(d);
  });
}
function flipMemCard(d,card){
  if(memLock||d.classList.contains('flipped')||d.classList.contains('matched'))return;
  d.classList.add('flipped');memFlipped.push({el:d,card});
  if(memFlipped.length===2){
    memTries++;document.getElementById('memTries').textContent=memTries;memLock=true;
    const [a,b]=memFlipped;
    if(a.card.word===b.card.word&&a.card.type!==b.card.type){
      a.el.classList.add('matched');b.el.classList.add('matched');
      memMatched++;document.getElementById('memPairs').textContent=memMatched;
      memFlipped=[];memLock=false;speak('Match!');
      if(memMatched>=5){confettiBurst();speak('You matched all cards! Amazing!');earnStickerIfFirst('memory');}
    }else{
      setTimeout(()=>{a.el.classList.remove('flipped');b.el.classList.remove('flipped');memFlipped=[];memLock=false;},1000);
    }
  }
}

// ============================================================
// GAME 10: SOUND MATCH
// ============================================================
function loadSoundMatch(){
  const idx=Math.floor(Math.random()*PH.words.length);
  smCurrentWord=PH.words[idx];
  const correct={w:smCurrentWord,e:PH.emojis[idx]};
  const others=PH.words.filter((_,i)=>i!==idx).map((w,i)=>({w,e:PH.emojis.filter((_,j)=>j!==idx)[i]||'â“'}));
  const choices=shuffle([correct,...shuffle(others).slice(0,3)]);
  const q=document.getElementById('soundMatchQ');
  q.innerHTML=`<h3>ğŸ”Š Tap to Hear the Word!</h3><p>Listen, then pick the right picture</p>`;
  document.getElementById('soundMatchResult').style.display='none';
  const sc=document.getElementById('soundChoices');sc.innerHTML='';
  choices.forEach(c=>{
    const d=document.createElement('div');d.className='sound-choice';d.textContent=c.e;
    d.title=c.w;
    d.onclick=()=>checkSoundMatch(c.w===smCurrentWord,d);
    sc.appendChild(d);
  });
}
function playSoundMatchWord(){const u=new SpeechSynthesisUtterance(smCurrentWord);u.rate=0.7;u.pitch=1.1;window.speechSynthesis.speak(u);}
function checkSoundMatch(correct,el){
  document.querySelectorAll('.sound-choice').forEach(d=>d.onclick=null);
  const r=document.getElementById('soundMatchResult');r.style.display='block';
  if(correct){el.classList.add('correct');smScore++;document.getElementById('smScore').textContent=smScore;setStatus('soundMatchResult',`ğŸ‰ Correct! That's "${smCurrentWord}"!`,'success');confettiBurst();earnStickerIfFirst('soundmatch');}
  else{el.classList.add('wrong');setStatus('soundMatchResult',`âŒ Not quite! The word was "${smCurrentWord}"!`,'error');}
  setTimeout(()=>loadSoundMatch(),2000);
}

// ============================================================
// GAME 11: SORTING BIN
// ============================================================
const SORT_ALL_WORDS=[
  {w:'apple',has:true},{w:'moon',has:false},{w:'ant',has:true},{w:'star',has:false},
  {w:'tree',has:false},{w:'arrow',has:true},{w:'duck',has:false},{w:'pen',has:false}
];
function initSortBins(){
  sortWords=[];
  // Words that have the letter
  PH.words.slice(0,4).forEach(w=>sortWords.push({w,has:w.toUpperCase().includes(CL)}));
  // Distractor words
  ['moon','tree','star','dog','sun','pen','rock','bird'].forEach(w=>sortWords.push({w,has:w.toUpperCase().includes(CL)}));
  sortWords=shuffle(sortWords);sortIdx=0;
  document.getElementById('binLetter').textContent=CL;
  document.getElementById('binLetter2').textContent=CL;
  document.getElementById('binYesItems').innerHTML='';
  document.getElementById('binNoItems').innerHTML='';
  document.getElementById('sortResult').style.display='none';
  loadNextSortWord();
}
function loadNextSortWord(){
  if(sortIdx>=sortWords.length){setStatus('sortResult','ğŸ‰ You sorted all the words!','success');confettiBurst();earnStickerIfFirst('sort');return;}
  const s=document.getElementById('sortCard');
  s.textContent=sortWords[sortIdx].w.toUpperCase();
  s.draggable=true;
  s.ondragstart=e=>e.dataTransfer.setData('text','sort');
  document.getElementById('sortResult').style.display='none';
}
function allowDrop(e){e.preventDefault();e.currentTarget.classList.add('drag-over');}
function dropSort(e,bin){
  e.preventDefault();document.querySelectorAll('.sort-bin').forEach(b=>b.classList.remove('drag-over'));
  processSortAnswer(bin);
}
function touchSort(bin){processSortAnswer(bin);}
function nextSortWord(){sortIdx++;loadNextSortWord();}
function processSortAnswer(bin){
  if(sortIdx>=sortWords.length)return;
  const item=sortWords[sortIdx];
  const correct=(bin==='yes'&&item.has)||(bin==='no'&&!item.has);
  const chip=document.createElement('div');chip.className=`sort-chip ${correct?'correct-place':'wrong-place'}`;chip.textContent=item.w;
  if(correct){document.getElementById('binYesItems').appendChild(chip);speak(`Yes! ${item.w} has the letter ${CL}!`);}
  else{document.getElementById('binNoItems').appendChild(chip);speak(`Try again next time!`);}
  const r=document.getElementById('sortResult');r.style.display='block';
  setStatus('sortResult',correct?`âœ… "${item.w}" goes in the right bin!`:`âŒ "${item.w}" should be in the ${item.has?'has':'no'} bin!`,correct?'success':'error');
  setTimeout(()=>{sortIdx++;loadNextSortWord();},1500);
}

// ============================================================
// GAME 12: POSITION SORT
// ============================================================
let posCurrentWord='',posCorrectPos='';
function nextPositionWord(){
  const w=PH.words[posIdx%PH.words.length];
  const e=PH.emojis[posIdx%PH.emojis.length];
  posCurrentWord=w.toUpperCase();
  const idx=posCurrentWord.indexOf(CL);
  let pos='middle';
  if(idx===0)pos='beginning';
  else if(idx===posCurrentWord.length-1)pos='end';
  posCorrectPos=pos;
  document.getElementById('posHint').textContent=e;
  let html='';
  for(let i=0;i<posCurrentWord.length;i++){
    html+=posCurrentWord[i]===CL?`<span class="hl">${posCurrentWord[i]}</span>`:posCurrentWord[i];
  }
  document.getElementById('posWord').innerHTML=html;
  document.getElementById('posResult').style.display='none';
  // Reset all pos buttons cleanly
  document.querySelectorAll('.pos-btn').forEach(b=>{
    b.classList.remove('correct','incorrect');
    b.disabled=false;
  });
  posIdx++;
}
function checkPosition(chosen){
  document.querySelectorAll('.pos-btn').forEach(b=>b.disabled=true);
  const r=document.getElementById('posResult');r.style.display='block';
  // Find the button that matches chosen
  document.querySelectorAll('.pos-btn').forEach(b=>{
    if(b.dataset.pos===chosen){
      if(chosen===posCorrectPos)b.classList.add('correct');
      else b.classList.add('incorrect');
    }
    if(b.dataset.pos===posCorrectPos)b.classList.add('correct');
  });
  if(chosen===posCorrectPos){
    setStatus('posResult',`ğŸ‰ Correct! "${CL}" is at the ${posCorrectPos}!`,'success');confettiBurst();earnStickerIfFirst('position');
  }else{
    setStatus('posResult',`âŒ Not quite! "${CL}" is at the ${posCorrectPos}.`,'error');
  }
}

// GAME 13: SILLY SENTENCE
// ============================================================
function buildSillyS(){
  const SILLY_ADJ=['silly','sweet','speedy','sleepy','small','bouncy','fluffy','grumpy'];
  const SILLY_VERB=['jumps','runs','sings','dances','sleeps','laughs','skips','flies'];
  const SILLY_PLACE=['at school','in the park','near a pond','on a hill','by the sea','under a rainbow','in a jungle','on the moon'];
  sillyPicks=['','','',''];
  const g=document.getElementById('wordSelectGroups');g.innerHTML='';
  const groups=[
    {label:'ğŸ¨ Pick an adjective:',words:shuffle(SILLY_ADJ).slice(0,4),idx:0},
    {label:`ğŸ¾ Pick a ${CL}-word:`,words:shuffle(PH.words).slice(0,4),idx:1},
    {label:'ğŸƒ Pick an action:',words:shuffle(SILLY_VERB).slice(0,4),idx:2},
    {label:'ğŸ“ Pick a place:',words:shuffle(SILLY_PLACE).slice(0,4),idx:3}
  ];
  groups.forEach(gr=>{
    const div=document.createElement('div');div.style.marginBottom='12px';
    div.innerHTML=`<p style="font-weight:800;color:var(--text);font-size:.9rem;margin-bottom:6px;">${gr.label}</p>`;
    const row=document.createElement('div');row.className='word-select-row';
    gr.words.forEach(w=>{
      const p=document.createElement('div');p.className='word-pill';p.textContent=w;
      p.onclick=function(){
        row.querySelectorAll('.word-pill').forEach(x=>x.classList.remove('picked'));
        p.classList.add('picked');sillyPicks[gr.idx]=w;updateSentence();
      };
      row.appendChild(p);
    });
    div.appendChild(row);g.appendChild(div);
  });
  document.getElementById('sentenceDisplay').textContent='Pick words above to build your sentence! ğŸ˜„';
}
function updateSentence(){
  if(sillyPicks.every(p=>p)){
    const s=`The ${sillyPicks[0]} ${sillyPicks[1]} ${sillyPicks[2]} ${sillyPicks[3]}!`;
    document.getElementById('sentenceDisplay').textContent=s;
  }
}
function readSillyS(){
  const t=document.getElementById('sentenceDisplay').textContent;
  if(t.includes('Pick words'))return;speak(t);earnStickerIfFirst('silly');
}

// ============================================================
// GAME 14: STORY STARTER
// ============================================================
const STORIES={
  A:["One day, an amazing ant found a magical "],
  B:["Big brave bear bought a beautiful "],
  C:["Clever cat climbed a castle and discovered a "],
  D:["Daring duck dove into the deep water and found a "],
  E:["Eager eagle flew east and found an extraordinary "],
  F:["Friendly frog found a funny "],
  G:["Great gorilla gave everyone a giant "],
  H:["Happy hippo hopped over hills to find a "],
  I:["Incredible iguana invented an amazing "],
  J:["Jumpy jaguar jumped over jungles to discover a "],
  K:["Kind kangaroo kept a special "],
  L:["Little lion looked for a lovely "],
  M:["Magical monkey made a mysterious "],
  N:["Ninja nightowl noticed a new "],
  O:["One octopus opened an old "],
  P:["Playful panda picked up a peculiar "],
  Q:["The queen quietly opened a quirky "],
  R:["Roaring rabbit ran really fast to reach a "],
  S:["Silly snake slid through the sand to find a "],
  T:["Tiny turtle traveled far to touch a "],
  U:["Unusual unicorn uncovered an unbelievable "],
  V:["Very brave vulture ventured into a "],
  W:["Wandering whale watched wonderful "],
  X:["Extraordinary fox found a magical x-ray that showed a "],
  Y:["Young yak yelled when it spotted a "],
  Z:["Zesty zebra zigzagged to find a "]
};
function loadStory(){
  const storyStarters=STORIES[CL]||[`One day, a little ${PH.words[0]} went on an adventure and found...`];
  const extras=PH.words.map(w=>`One day, a little ${w} went on an adventure and found...`);
  extras.push(`The brave ${PH.words[0]} had never seen anything like it before...`);
  const all=[...storyStarters,...extras];
  const prompt=all[storyIdx%all.length];
  document.getElementById('storyPrompt').textContent=prompt;
  document.getElementById('storyText').value='';
  document.getElementById('storyStatus').style.display='none';
}
function readMyStory(){
  const text=document.getElementById('storyPrompt').textContent+' '+document.getElementById('storyText').value;
  speak(text);
}
function nextStory(){storyIdx++;loadStory();}
function toggleStoryRec(){
  if(storyRecording){if(storyRecognition)storyRecognition.stop();storyRecording=false;document.getElementById('storyRecBtn').textContent='ğŸ¤ Record Me!';}
  else{
    if(!('webkitSpeechRecognition' in window)&&!('SpeechRecognition' in window)){alert('Speech recognition not available on this browser. Try Chrome!');return;}
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    storyRecognition=new SR();storyRecognition.lang='en-US';storyRecognition.continuous=true;storyRecognition.interimResults=false;
    storyRecognition.onstart=()=>{storyRecording=true;document.getElementById('storyRecBtn').textContent='â¹ï¸ Stop';const s=document.getElementById('storyStatus');s.style.display='block';setStatus('storyStatus','ğŸ¤ Recording your story...','recording');};
    storyRecognition.onresult=e=>{const t=Array.from(e.results).map(r=>r[0].transcript).join(' ');document.getElementById('storyText').value=t;};
    storyRecognition.onerror=()=>{storyRecording=false;document.getElementById('storyRecBtn').textContent='ğŸ¤ Record Me!';};
    storyRecognition.onend=()=>{storyRecording=false;document.getElementById('storyRecBtn').textContent='ğŸ¤ Record Me!';setStatus('storyStatus','âœ… Done recording!','success');};
    storyRecognition.start();
  }
}

// ============================================================
// GAME 15: TAP THE LETTER
// ============================================================
const COLORS_FALL=['#FF6B9D','#FFD93D','#4FC3F7','#69E090','#B388FF','#FFA552','#FF4757','#26de81'];
let tapTimeLeft=30;
function resetTapUI(){
  tapScore=0;tapLives=3;tapActive=false;
  document.getElementById('tapScore').textContent=0;
  document.getElementById('tapTimer').textContent='â±ï¸ 30s';
  document.getElementById('tapLives').textContent='â¤ï¸â¤ï¸â¤ï¸';
  document.getElementById('tapArena').innerHTML='';
  document.getElementById('tapResult').style.display='none';
  document.getElementById('tapStartBtn').style.display='block';
  document.getElementById('tapDesc').textContent=`Tap only the letter "${CL}" â€” ignore the others!`;
}
function startTapGame(){
  tapScore=0;tapLives=3;tapActive=true;tapTimeLeft=30;
  document.getElementById('tapStartBtn').style.display='none';
  document.getElementById('tapResult').style.display='none';
  document.getElementById('tapArena').innerHTML='';
  tapCountdown=setInterval(()=>{
    tapTimeLeft--;document.getElementById('tapTimer').textContent=`â±ï¸ ${tapTimeLeft}s`;
    if(tapTimeLeft<=0)endTapGame();
  },1000);
  tapInterval=setInterval(spawnFallingLetter,900);
  spawnFallingLetter();
}
function spawnFallingLetter(){
  if(!tapActive)return;
  const arena=document.getElementById('tapArena');
  const isTarget=Math.random()>0.4;
  const letter=isTarget?CL:getRandomLetter();
  const el=document.createElement('div');el.className='falling-letter';
  el.textContent=letter;
  const color=COLORS_FALL[Math.floor(Math.random()*COLORS_FALL.length)];
  el.style.background=color;el.style.color='#fff';
  const dur=2.5+Math.random()*1.5;
  el.style.animationDuration=`${dur}s`;
  el.style.left=`${5+Math.random()*75}%`;
  el.addEventListener('click',()=>{
    if(!tapActive)return;
    if(isTarget){tapScore++;document.getElementById('tapScore').textContent=tapScore;el.style.background=COLORS_FALL[1];el.textContent='â­';speak('Great!');earnStickerIfFirst('tap');}
    else{tapLives--;updateTapLives();if(tapLives<=0)endTapGame();el.style.background=COLORS_FALL[6];el.textContent='ğŸ’¥';}
    setTimeout(()=>{if(el.parentNode)el.parentNode.removeChild(el);},200);
  });
  el.addEventListener('animationend',()=>{
    if(el.parentNode)el.parentNode.removeChild(el);
  });
  arena.appendChild(el);
}
function updateTapLives(){
  const hearts=['â¤ï¸â¤ï¸â¤ï¸','â¤ï¸â¤ï¸ğŸ–¤','â¤ï¸ğŸ–¤ğŸ–¤','ğŸ–¤ğŸ–¤ğŸ–¤'];
  document.getElementById('tapLives').textContent=hearts[Math.max(0,3-tapLives)];
}
function getRandomLetter(){const ls='BCDFGHJKLMNPQRSTVWXYZ'.replace(CL,'').split('');return ls[Math.floor(Math.random()*ls.length)];}
function endTapGame(){
  tapActive=false;clearInterval(tapInterval);clearInterval(tapCountdown);
  const r=document.getElementById('tapResult');r.style.display='block';
  r.className='sound-status '+(tapScore>=5?'status-success':'status-neutral');
  r.textContent=`Game over! You scored ${tapScore} points! ${tapScore>=10?'ğŸ† Amazing!':tapScore>=5?'â­ Great!':'Keep practising! ğŸ’ª'}`;
  document.getElementById('tapStartBtn').style.display='block';document.getElementById('tapStartBtn').textContent='ğŸ”„ Play Again!';
  if(tapScore>=5)confettiBurst();
}
function stopTapGame(){tapActive=false;clearInterval(tapInterval);clearInterval(tapCountdown);}

// ============================================================
// GAME 16: WHACK-A-WORD
// ============================================================
const WHACK_POOL={has:[],no:['moon','star','pen','duck','tree','rock','car','sun']};
let whackHoles=[];let whackTimeLeft=45;
function resetWhackUI(){
  whackScore=0;whackLives=3;whackActive=false;
  document.getElementById('whackScore').textContent=0;
  document.getElementById('whackTimer').textContent='â±ï¸ 45s';
  document.getElementById('whackLives').textContent='â¤ï¸â¤ï¸â¤ï¸';
  document.getElementById('whackResult').style.display='none';
  document.getElementById('whackStartBtn').style.display='block';
  document.getElementById('whackDesc').textContent=`Whack moles that show words with "${CL}" â€” don't whack the others!`;
  buildWhackGrid();
}
function buildWhackGrid(){
  const g=document.getElementById('whackGrid');g.innerHTML='';whackHoles=[];
  for(let i=0;i<9;i++){
    const hole=document.createElement('div');hole.className='mole-hole';
    const mole=document.createElement('div');mole.className='mole';mole.textContent='';
    hole.appendChild(mole);
    hole.addEventListener('click',()=>whackMole(i));
    g.appendChild(hole);whackHoles.push({el:hole,mole,word:'',hasLetter:false,up:false});
  }
}
function startWhack(){
  whackScore=0;whackLives=3;whackActive=true;whackTimeLeft=45;
  document.getElementById('whackStartBtn').style.display='none';
  document.getElementById('whackResult').style.display='none';
  whackCountdown=setInterval(()=>{whackTimeLeft--;document.getElementById('whackTimer').textContent=`â±ï¸ ${whackTimeLeft}s`;if(whackTimeLeft<=0)endWhack();},1000);
  whackInterval=setInterval(()=>{if(whackActive)popMole();},1200);
}
function popMole(){
  const idle=whackHoles.filter(h=>!h.up);
  if(!idle.length)return;
  const h=idle[Math.floor(Math.random()*idle.length)];
  const useHas=Math.random()>0.4;
  let word,hasLetter;
  if(useHas&&PH.words.length){word=PH.words[Math.floor(Math.random()*PH.words.length)];hasLetter=true;}
  else{const pool=['moon','star','pen','duck','tree','rock','car','sun','frog','rain'];word=pool[Math.floor(Math.random()*pool.length)];hasLetter=word.toUpperCase().includes(CL);}
  h.word=word;h.hasLetter=hasLetter;h.up=true;h.mole.textContent=word.toUpperCase();h.mole.classList.add('up');
  setTimeout(()=>{if(h.up){h.mole.classList.remove('up');h.up=false;if(h.hasLetter){whackLives--;updateWhackLives();if(whackLives<=0)endWhack();}}},2000);
}
function whackMole(i){
  const h=whackHoles[i];if(!h.up||!whackActive)return;
  h.mole.classList.remove('up');h.up=false;
  if(h.hasLetter){whackScore++;document.getElementById('whackScore').textContent=whackScore;speak('Whack!');earnStickerIfFirst('whack');}
  else{whackLives--;updateWhackLives();if(whackLives<=0)endWhack();speak('Oops!');}
}
function updateWhackLives(){const hs=['â¤ï¸â¤ï¸â¤ï¸','â¤ï¸â¤ï¸ğŸ–¤','â¤ï¸ğŸ–¤ğŸ–¤','ğŸ–¤ğŸ–¤ğŸ–¤'];document.getElementById('whackLives').textContent=hs[Math.max(0,3-whackLives)];}
function endWhack(){whackActive=false;clearInterval(whackInterval);clearInterval(whackCountdown);whackHoles.forEach(h=>{h.mole.classList.remove('up');h.up=false;});const r=document.getElementById('whackResult');r.style.display='block';r.className='sound-status '+(whackScore>=5?'status-success':'status-neutral');r.textContent=`Done! You scored ${whackScore}! ${whackScore>=8?'ğŸ† Champion!':whackScore>=4?'â­ Nice!':'Keep trying! ğŸ’ª'}`;document.getElementById('whackStartBtn').style.display='block';document.getElementById('whackStartBtn').textContent='ğŸ”„ Play Again!';if(whackScore>=4)confettiBurst();}
function stopWhack(){whackActive=false;clearInterval(whackInterval);clearInterval(whackCountdown);}

// ============================================================
// GAME 17: CROSSWORD
// ============================================================
function initCrossword(){
  const ws=PH.words.slice(0,3).map(w=>w.toUpperCase());
  const emojis=PH.emojis.slice(0,3);
  const w0=ws[0],w1=ws[1],w2=ws[2];
  const maxLen=Math.max(w0.length,w1.length,w2.length)+1;
  const rows=w1.length+1;
  const cols=Math.max(maxLen,w2.length+1);
  // Use map() so each cell is a unique object (not shared reference)
  const grid=Array.from({length:rows},()=>Array.from({length:cols},()=>({black:true,letter:'',answer:'',num:''})));

  // Word 0: horizontal at row 0
  for(let i=0;i<w0.length;i++){grid[0][i]={black:false,letter:'',answer:w0[i],num:i===0?'1':''};}
  // Word 1: vertical from col 0
  for(let i=0;i<w1.length;i++){
    // Don't overwrite if already set by word0 (shared cell at [0][0])
    if(i===0&&grid[0][0].answer===w1[0]){grid[0][0].num='1';}
    else{grid[i][0]={black:false,letter:'',answer:w1[i],num:i===0?'2':''};}
  }
  // Word 2: horizontal at last row of word1
  const r2=w1.length-1;
  for(let i=0;i<w2.length&&i<cols;i++){grid[r2][i]={black:false,letter:'',answer:w2[i],num:i===0?'3':''};}

  cwData={grid,words:ws,emojis,clues:[
    `${emojis[0]} ${ws[0]} (${w0.length} letters)`,
    `${emojis[1]} ${ws[1]} (${w1.length} letters)`,
    `${emojis[2]} ${ws[2]} (${w2.length} letters)`
  ]};

  const cont=document.getElementById('cwContainer');cont.innerHTML='';
  const table=document.createElement('div');table.className='crossword-grid';table.style.display='inline-block';
  grid.forEach((row,ri)=>{
    const rowEl=document.createElement('div');rowEl.className='cw-row';
    row.forEach((cell,ci)=>{
      const c=document.createElement('div');c.className='cw-cell';
      if(cell.black){c.classList.add('black');}
      else{
        if(cell.num){const n=document.createElement('span');n.className='cw-num';n.textContent=cell.num;c.appendChild(n);}
        const inp=document.createElement('input');inp.maxLength=1;inp.dataset.row=ri;inp.dataset.col=ci;
        inp.addEventListener('input',function(){this.value=this.value.toUpperCase().slice(-1);});
        c.appendChild(inp);
      }
      rowEl.appendChild(c);
    });
    table.appendChild(rowEl);
  });
  cont.appendChild(table);

  const cl=document.getElementById('cwClues');cl.innerHTML='<h4>Clues:</h4>';
  const dirs=['â†’ Across','â†“ Down','â†’ Across'];
  cwData.clues.forEach((clue,i)=>{
    const d=document.createElement('div');d.className='cw-clue';
    d.innerHTML=`<span>${i+1}</span><strong>${dirs[i]}:</strong> ${clue}`;
    cl.appendChild(d);
  });
  document.getElementById('cwResult').style.display='none';
}
function checkCrossword(){
  if(!cwData)return;
  let allCorrect=true;
  document.querySelectorAll('.cw-cell input').forEach(inp=>{
    const r=parseInt(inp.dataset.row),ci=parseInt(inp.dataset.col);
    const cell=cwData.grid[r][ci];
    if(cell&&cell.answer){
      if(inp.value.toUpperCase()===cell.answer){inp.parentNode.classList.add('correct');inp.parentNode.classList.remove('active');}
      else{allCorrect=false;inp.parentNode.classList.add('active');inp.parentNode.classList.remove('correct');}
    }
  });
  const r=document.getElementById('cwResult');r.style.display='block';
  if(allCorrect){setStatus('cwResult','ğŸ‰ All correct! Amazing crossword!','success');confettiBurst();earnStickerIfFirst('crossword');}
  else{setStatus('cwResult','âŒ Some letters need fixing. Keep trying!','error');}
}

// ============================================================
// GAME 18: WORD SEARCH
// ============================================================
const WS_SIZE=9;
function initWordSearch(){
  wsGrid=Array.from({length:WS_SIZE},()=>Array(WS_SIZE).fill(''));
  wsWords=PH.words.slice(0,4).map(w=>w.toUpperCase());
  wsFoundCells=new Set();wsFoundWords=[];wsSelected=[];
  const placed=[];
  wsWords.forEach(w=>{
    if(placeWord(w))placed.push(w);
  });
  // Fill rest with random letters
  const alpha='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
  for(let r=0;r<WS_SIZE;r++){for(let c=0;c<WS_SIZE;c++){if(!wsGrid[r][c])wsGrid[r][c]=alpha[Math.floor(Math.random()*alpha.length)];}}

  const cont=document.getElementById('wsGridContainer');cont.innerHTML='';
  const gridEl=document.createElement('div');gridEl.className='ws-grid';
  for(let r=0;r<WS_SIZE;r++){
    const row=document.createElement('div');row.className='ws-row';
    for(let c=0;c<WS_SIZE;c++){
      const cell=document.createElement('div');cell.className='ws-cell';
      cell.textContent=wsGrid[r][c];cell.dataset.r=r;cell.dataset.c=c;
      cell.addEventListener('mousedown',wsStartSelect);
      cell.addEventListener('mouseover',wsMouseOver);
      cell.addEventListener('touchstart',wsTouchStart,{passive:false});
      row.appendChild(cell);
    }
    gridEl.appendChild(row);
  }
  document.addEventListener('mouseup',wsEndSelect);
  gridEl.addEventListener('touchend',wsEndSelect,{passive:false});
  cont.appendChild(gridEl);

  const wl=document.getElementById('wsWordList');wl.innerHTML='';
  wsWords.forEach(w=>{
    const d=document.createElement('div');d.className='ws-word';d.id=`ws-${w}`;d.textContent=w;wl.appendChild(d);
  });
  document.getElementById('wsResult').style.display='none';
}
function placeWord(word){
  const dirs=[[0,1],[1,0],[0,-1],[-1,0]];
  for(let tries=0;tries<80;tries++){
    const dir=dirs[Math.floor(Math.random()*dirs.length)];
    const sr=Math.floor(Math.random()*WS_SIZE),sc=Math.floor(Math.random()*WS_SIZE);
    const er=sr+dir[0]*(word.length-1),ec=sc+dir[1]*(word.length-1);
    if(er<0||er>=WS_SIZE||ec<0||ec>=WS_SIZE)continue;
    let ok=true;
    for(let i=0;i<word.length;i++){const r=sr+dir[0]*i,c=sc+dir[1]*i;if(wsGrid[r][c]&&wsGrid[r][c]!==word[i]){ok=false;break;}}
    if(ok){for(let i=0;i<word.length;i++){wsGrid[sr+dir[0]*i][sc+dir[1]*i]=word[i];}return true;}
  }
  return false;
}
let wsSelecting=false,wsStartCell=null;
function wsStartSelect(e){
  e.preventDefault();
  wsSelecting=true;
  wsStartCell=e.currentTarget;
  document.querySelectorAll('.ws-cell').forEach(c=>c.classList.remove('selected'));
  e.currentTarget.classList.add('selected');
}
function wsMouseOver(e){
  if(!wsSelecting)return;
  // Highlight a straight line from start to current cell
  if(!wsStartCell)return;
  const all=[...document.querySelectorAll('.ws-cell')];
  const sr=parseInt(wsStartCell.dataset.r),sc=parseInt(wsStartCell.dataset.c);
  const er=parseInt(e.currentTarget.dataset.r),ec=parseInt(e.currentTarget.dataset.c);
  const dr=Math.sign(er-sr),dc=Math.sign(ec-sc);
  // Only allow straight or diagonal lines
  const rowDiff=Math.abs(er-sr),colDiff=Math.abs(ec-sc);
  if(rowDiff!==colDiff&&rowDiff!==0&&colDiff!==0)return;
  all.forEach(c=>c.classList.remove('selected'));
  let r=sr,c=sc;
  const steps=Math.max(rowDiff,colDiff);
  for(let i=0;i<=steps;i++){
    const cell=all.find(c=>parseInt(c.dataset.r)===r&&parseInt(c.dataset.c)===c.dataset.c);
    // use querySelector for precision
    const found=document.querySelector(`.ws-cell[data-r="${r}"][data-c="${c}"]`);
    if(found)found.classList.add('selected');
    r+=dr;c+=dc;
  }
}
function wsTouchStart(e){
  e.preventDefault();
  wsSelecting=true;
  document.querySelectorAll('.ws-cell').forEach(c=>c.classList.remove('selected'));
  const t=e.touches[0];
  const el=document.elementFromPoint(t.clientX,t.clientY);
  if(el&&el.classList.contains('ws-cell')){wsStartCell=el;el.classList.add('selected');}
}
function wsTouchMove(e){
  e.preventDefault();
  if(!wsSelecting||!wsStartCell)return;
  const t=e.touches[0];
  const el=document.elementFromPoint(t.clientX,t.clientY);
  if(el&&el.classList.contains('ws-cell')){
    const sr=parseInt(wsStartCell.dataset.r),sc=parseInt(wsStartCell.dataset.c);
    const er=parseInt(el.dataset.r),ec=parseInt(el.dataset.c);
    const dr=Math.sign(er-sr),dc=Math.sign(ec-sc);
    const rowDiff=Math.abs(er-sr),colDiff=Math.abs(ec-sc);
    if(rowDiff!==colDiff&&rowDiff!==0&&colDiff!==0)return;
    document.querySelectorAll('.ws-cell').forEach(c=>c.classList.remove('selected'));
    let r=sr,c=sc;
    const steps=Math.max(rowDiff,colDiff);
    for(let i=0;i<=steps;i++){
      const found=document.querySelector(`.ws-cell[data-r="${r}"][data-c="${c}"]`);
      if(found)found.classList.add('selected');
      r+=dr;c+=dc;
    }
  }
}
function wsEndSelect(e){
  if(!wsSelecting)return;
  wsSelecting=false;
  document.removeEventListener('touchmove',wsTouchMove);
  const sel=[...document.querySelectorAll('.ws-cell.selected')];
  const formed=sel.map(c=>c.textContent).join('');
  const formed_r=formed.split('').reverse().join('');
  const found=wsWords.find(w=>!wsFoundWords.includes(w)&&(w===formed||w===formed_r));
  if(found){
    sel.forEach(c=>{c.classList.remove('selected');c.classList.add('found');});
    wsFoundWords.push(found);
    const wEl=document.getElementById(`ws-${found}`);if(wEl)wEl.classList.add('found');
    speak(`Found ${found}!`);earnStickerIfFirst('wordsearch');
    if(wsFoundWords.length>=wsWords.length){
      const r=document.getElementById('wsResult');r.style.display='block';
      setStatus('wsResult','ğŸ‰ You found all the words!','success');confettiBurst();
    }
  }else{
    sel.forEach(c=>c.classList.remove('selected'));
  }
}

// ============================================================
// GAME 19: STICKER BOOK + BINGO
// ============================================================
const ACTIVITY_STICKERS={sound:'ğŸ”Š',trace:'âœï¸',circle:'â­•',fill:'â“',builder:'ğŸ§±',anagram:'ğŸ”€',memory:'ğŸƒ',soundmatch:'ğŸµ',sort:'ğŸ—‚ï¸',position:'ğŸ“',silly:'ğŸ˜‚',tap:'âš¡',whack:'ğŸ”¨',crossword:'âœï¸',wordsearch:'ğŸ”'};
const earnedStickers=new Set();
function initStickerBook(){
  earnedStickers.clear();stickerCount=0;
  const b=document.getElementById('stickerBook');b.innerHTML='';
  Object.entries(ACTIVITY_STICKERS).forEach(([key,emoji])=>{
    const s=document.createElement('div');s.className='sticker-slot';s.id=`sticker-${key}`;
    s.innerHTML=`<span style="font-size:1.8rem;filter:grayscale(1);opacity:.3;">${emoji}</span><span class="sl">${key}</span>`;
    b.appendChild(s);
  });
  updateStickerProgress();
}
function earnStickerIfFirst(key){
  if(earnedStickers.has(key))return;
  earnedStickers.add(key);stickerCount++;
  const s=document.getElementById(`sticker-${key}`);
  if(s){s.classList.add('earned');s.querySelector('span').style.filter='none';s.querySelector('span').style.opacity='1';}
  updateStickerProgress();
}
function earnSticker(){earnStickerIfFirst(Object.keys(ACTIVITY_STICKERS)[Math.floor(Math.random()*Object.keys(ACTIVITY_STICKERS).length)]);}
function updateStickerProgress(){const total=Object.keys(ACTIVITY_STICKERS).length;document.getElementById('stickerFill').style.width=`${(stickerCount/total)*100}%`;}

// BINGO
function initBingo(){
  const allW=PH.words.slice(0,5);
  const filler=['moon','star','dog','sun','cat'].filter(w=>!allW.includes(w));
  const pool=shuffle([...allW,...filler]).slice(0,9);
  bingoCard=pool.map((w,i)=>({w,e:PH.emojis[allW.indexOf(w)]||'ğŸ¯',marked:false}));
  bingoCalled=[];bingoCallIdx=0;
  const c=document.getElementById('bingoCard');c.innerHTML='';
  bingoCard.forEach((item,i)=>{
    const d=document.createElement('div');d.className='bingo-cell';d.id=`bc${i}`;
    d.innerHTML=`<span class="bc-emoji">${item.e}</span><span class="bc-word">${item.w.toUpperCase()}</span>`;
    d.onclick=()=>{if(item.marked)return;item.marked=true;d.classList.add('marked');checkBingo();};
    c.appendChild(d);
  });
  document.getElementById('bingoResult').style.display='none';
  document.getElementById('bingoCallText').textContent='ğŸ¯ Tap to Call a Word!';
}
let bingoCurrentCall='';
function callBingo(){
  const remaining=bingoCard.filter(b=>!bingoCalled.includes(b.w));
  if(!remaining.length){document.getElementById('bingoCallText').textContent='All called! Start new game!';return;}
  const item=remaining[Math.floor(Math.random()*remaining.length)];
  bingoCalled.push(item.w);bingoCurrentCall=item.w;
  document.getElementById('bingoCallText').textContent=`${item.e} ${item.w.toUpperCase()}`;
  speak(item.w);
}
function checkBingo(){
  const idxs=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
  const won=idxs.some(line=>line.every(i=>bingoCard[i].marked));
  if(won){
    idxs.forEach(line=>{if(line.every(i=>bingoCard[i].marked))line.forEach(i=>{document.getElementById(`bc${i}`).classList.add('bingo-winner');});});
    const r=document.getElementById('bingoResult');r.style.display='block';setStatus('bingoResult','ğŸ‰ BINGO! You won!','success');confettiBurst();earnStickerIfFirst('bingo');speak('Bingo! You won!');
  }
}

// ============================================================
// UTILS
// ============================================================
function speak(text){window.speechSynthesis.cancel();const u=new SpeechSynthesisUtterance(text);u.rate=0.85;u.pitch=1.2;window.speechSynthesis.speak(u);}
function shuffle(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}
function setStatus(id,msg,type){const el=document.getElementById(id);if(!el)return;el.textContent=msg;el.className=`sound-status status-${type}`;}
function confettiBurst(){
  const c=document.getElementById('confetti');
  const cols=['#FF6B9D','#FFD93D','#4FC3F7','#69E090','#B388FF','#FFA552'];
  for(let i=0;i<50;i++){
    const p=document.createElement('div');p.className='confetti-piece';
    p.style.cssText=`left:${Math.random()*100}%;background:${cols[Math.floor(Math.random()*cols.length)]};animation-duration:${1.5+Math.random()*2}s;animation-delay:${Math.random()*.5}s;width:${6+Math.random()*10}px;height:${6+Math.random()*10}px;border-radius:${Math.random()>.5?'50%':'2px'};`;
    c.appendChild(p);setTimeout(()=>{if(p.parentNode)p.parentNode.removeChild(p);},4000);
  }
}
</script>
</body>
</html>
